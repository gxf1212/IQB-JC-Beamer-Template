% ============================================================
% IQB Journal Club Layout Utilities
%
% LaTeX Beamer 布局工具包 - 为 IQB 课题组文献分享演示提供
% 统一的、可复用的布局命令和页面模块
%
% 版本: 1.1 | 最后更新: 2025-10-23
%
% 快速开始:
%   \usepackage{iqb-layouts}
%
% 主要功能模块:
%   1. 布局命令 - \iqblayouttwo, \iqblayoutthree, \iqbgridtwobytwo 等
%   2. 图片模块 - \iqbfig, \iqbtwofig, \iqbfourfig（自动编号）
%   3. 文字+图片混合 - \iqbimagetext, \iqbtextimage
%   4. 作者信息 - \iqbauthorstwophoto, \iqbauthorstwo
%   5. 对比模块 - \iqbcomparetwo, \iqbcomparethree
%   6. Frame 快捷命令 - \iqbframe, \iqbframetextfig 等
%   7. 间距命令 - \iqbsep, \iqbbigsep, \iqbtinysep
%   8. 视觉增强 - \emphdata, \keyfinding, 彩色punchline框
%
% 详细说明: 见本文件下方的每个模块注释
% ============================================================
%
% ============================================================
% 内容密度最佳实践 (Content Density Best Practices)
% ============================================================
% 根据学术Beamer最佳实践（2025），建议遵循以下原则以提高可读性：
%
% 【6-6-6 规则】（推荐但非强制）：
%   - 每页最多 6 个 bullet points
%   - 每个 bullet 最多 6 个词（中文约 12 字）
%   - 连续文字页不超过 6 页
%
% 【内容拆分建议】：
%   - 内容超过 10 行 → 考虑拆分为 2 页
%   - 图片+文字溢出 → 调整图片高度或拆页
%   - 编译警告 "Overfull \vbox" → 必须减少内容或拆页
%
% 【字号层级系统】（11pt 基准）：
%   \large (12pt)       - frametitle（由主题自动应用）
%   \normalsize (11pt)  - 重要正文、关键数据（手动使用）
%   \footnotesize (9pt) - 标准正文、图注（默认）
%   \scriptsize (8pt)   - 备注、参考文献、表格
%
% 【视觉层次建议】：
%   - 使用 \emphdata{} 强调关键数据（大号蓝色加粗）
%   - 使用 \keyfinding{} 高亮核心结论（黄色背景）
%   - 使用彩色 punchline 框区分重要性：
%     * \iqbbluebox - 核心观点（蓝色，最常用）
%     * \iqborangebox - 警示/挑战（橙色）
%     * \iqbgreenbox - 成功/验证（绿色）
% ============================================================

\ProvidesPackage{iqb-layouts}[2025/01/20 v1.0 IQB Journal Club Layout Utilities]

\RequirePackage{graphicx}
\RequirePackage{tikz}
\usetikzlibrary{positioning,calc}

% ============================================================
% Spacing Commands (统一的间距系统)
% ============================================================
%
% 该包提供了三个标准的间距命令，用于替代手动的 \medskip, \bigskip,
% \smallskip, \vspace{}。使用统一的间距命令可以确保整个演示的视觉一致性。
%
% 使用建议:
%   - 优先使用 \iqbsep（标准间距）分隔逻辑块
%   - \iqbtinysep 用于列表项之间或紧凑布局
%   - \iqbbigsep 用于主要内容块之间的大分隔
%
% 示例:
%   \begin{itemize}
%     \item 第一点
%     \item 第二点
%   \end{itemize}
%   \iqbsep  %← 使用统一间距而不是 \vspace{0.3cm}
%   \begin{block}{重点}
%     ...
%   \end{block}
%
\newcommand{\iqbsep}{\vspace{0.3cm}}       % 标准段落间距 (~0.3cm)，最常用
\newcommand{\iqbbigsep}{\vspace{0.5cm}}    % 大段落间距 (~0.5cm)，用于主要分节
\newcommand{\iqbtinysep}{\vspace{0.15cm}}  % 小间距 (~0.15cm)，用于列表项间

% ============================================================
% Two-Column Layouts (双列布局 - 35% 使用率)
% ============================================================
%
% 双列布局是 JC 演示的核心布局类型（约 35% 的页面使用）。
% 本包提供了多种双列布局，覆盖常见的比例分割。
%
% 【1. 标准 50-50 双列】
% \iqblayouttwo{左列}{右列}
% 用途: 对比、左右平行内容、方法对比
% 布局: 左 48% + 间隔 4% + 右 48%
% 示例:
%   \begin{frame}{方法对比}
%     \iqblayouttwo{
%       方法A \\
%       优点: 快速
%     }{
%       方法B \\
%       优点: 精确
%     }
%   \end{frame}
%
\newcommand{\iqblayouttwo}[2]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      #1
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      #2
    \end{column}
  \end{columns}
}

% 【2. 非对称 1/3:2/3 双列（图在左，文在右）】
% \iqblayoutonethird{左侧（窄）}{右侧（宽）}
% 用途: 左侧是图或装置，右侧是详细说明
% 布局: 左 31% + 间隔 4% + 右 65%
% 建议: 左侧图片宽度设为 width=0.25-0.30\textwidth
% 示例:
%   \iqblayoutonethird{
%     \includegraphics[width=0.3\textwidth]{device.png}
%   }{
%     \textbf{详细说明} \\
%     这是该装置的工作原理...
%   }
%
\newcommand{\iqblayoutonethird}[2]{%
  \begin{columns}[T]
    \begin{column}{0.31\textwidth}
      #1
    \end{column}
    \hfill
    \begin{column}{0.65\textwidth}
      #2
    \end{column}
  \end{columns}
}

% 【3. 非对称 2/3:1/3 双列（文在左，图在右）】
% \iqblayouttwothirds{左侧（宽）}{右侧（窄）}
% 用途: 左侧是详细说明或列表，右侧是图或数据
% 布局: 左 65% + 间隔 4% + 右 31%
% 建议: 右侧图片宽度设为 width=0.25-0.30\textwidth
%
\newcommand{\iqblayouttwothirds}[2]{%
  \begin{columns}[T]
    \begin{column}{0.65\textwidth}
      #1
    \end{column}
    \hfill
    \begin{column}{0.31\textwidth}
      #2
    \end{column}
  \end{columns}
}

% 【3.5 两张图片并排（无caption，支持间距控制）】
% Usage: \iqbtwoimgside[间距]{左图内容}{右图内容}
% 例如: \iqbtwoimgside[0.2cm]{\iqbimgcenter[height=0.4\textheight]{img1.png}}{\iqbimgcenter[height=0.4\textheight]{img2.png}}
\newcommand{\iqbtwoimgside}[3][0.3cm]{%
  \begin{columns}[T]
    \begin{column}{0.45\textwidth}
      \centering
      #2
    \end{column}
    \hspace{#1}
    \begin{column}{0.45\textwidth}
      \centering
      #3
    \end{column}
  \end{columns}
}

% 【4. 自定义比例双列】
% \iqblayoutcustom[左宽度]{左列}{右列}
% 用途: 任意比例的双列分割
% 参数: [可选] 左列宽度（默认 0.4\textwidth）
% 示例:
%   \iqblayoutcustom[0.35]{
%     窄左列
%   }{
%     宽右列
%   }
%   或
%   \iqblayoutcustom[0.6]{
%     宽左列
%   }{
%     窄右列
%   }
%
\newcommand{\iqblayoutcustom}[3][0.4]{%
  \begin{columns}[T]
    \begin{column}{#1\textwidth}
      #2
    \end{column}
    \hfill
    \begin{column}{\dimexpr 1\textwidth - #1\textwidth - 0.04\textwidth\relax}
      #3
    \end{column}
  \end{columns}
}

% ============================================================
% Three-Column Layouts (三列布局 - 25% 使用率)
% ============================================================
%
% 【1. 标准三列均分】
% \iqblayoutthree{列1}{列2}{列3}
% 用途: 三方对比、三个方法、三个结果展示
% 布局: 每列 31% (中间有间隔)
% 注意: 内容受限，字号会自动缩小
% 建议每列图片高度: height=0.35-0.40\textheight
% 示例:
%   \iqblayoutthree{
%     \centering
%     \textbf{方法A} \\
%     \includegraphics[height=0.35\textheight]{img1.png}
%   }{
%     \centering
%     \textbf{方法B} \\
%     \includegraphics[height=0.35\textheight]{img2.png}
%   }{
%     \centering
%     \textbf{我们的方法} \\
%     \includegraphics[height=0.35\textheight]{img3.png}
%   }
%
\newcommand{\iqblayoutthree}[3]{%
  \begin{columns}[T]
    \begin{column}{0.31\textwidth}
      #1
    \end{column}
    \begin{column}{0.31\textwidth}
      #2
    \end{column}
    \begin{column}{0.31\textwidth}
      #3
    \end{column}
  \end{columns}
}

% ============================================================
% Grid Layouts for Multiple Images (网格布局 - 少见)
% ============================================================
%
% 网格布局用于展示多个相关的图表，特别是用于矩阵式的数据展示。
% 最常见的是 2×2 和 3×2 网格。

% 【1. 2×2 网格（4 个图或面板）】
\newcommand{\iqbgridtwobytwo}[4]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      #1
      \vskip1em
      #3
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      #2
      \vskip1em
      #4
    \end{column}
  \end{columns}
}

% 3x2 Grid (6 images)
\newcommand{\iqbgridthreebytwo}[6]{%
  \begin{columns}[T]
    \begin{column}{0.31\textwidth}
      #1
      \vskip0.5em
      #4
    \end{column}
    \begin{column}{0.31\textwidth}
      #2
      \vskip0.5em
      #5
    \end{column}
    \begin{column}{0.31\textwidth}
      #3
      \vskip0.5em
      #6
    \end{column}
  \end{columns}
}

% ============================================================
% Figure Modules with Numbered Captions (带编号的图片模块 - 最常用)
% ============================================================
%
% 该包提供的图片模块自动处理图片编号、对齐和图注格式。
% 所有图注都是左对齐，编号自动递增。
% 这是展示实验结果、数据分析、装置图等的标准方式。
%
% 【重要】: 使用这些命令比手动排版图片更简洁、更一致。

% 内部计数器（自动维护）
\newcounter{iqbfigure}
\setcounter{iqbfigure}{0}

% 【1. 单个图片】
% \iqbfig[图片选项]{图片路径}{图注文本}
% 参数:
%   [可选] 图片选项: height=0.5\textheight (默认), width=\textwidth 等
%   图片路径: 相对或绝对路径，如 images/fig1.png
%   图注文本: 在"图N："后的描述文字
% 示例:
%   \iqbfig{images/structure.png}{蛋白质主链构象}
%   \iqbfig[height=0.6\textheight]{images/result.png}{能量景观的三维表示}
% 输出:
%   [图像]
%   图1: 蛋白质主链构象
%
\newcommand{\iqbfig}[3][height=0.5\textheight]{%
  \refstepcounter{iqbfigure}%
  \centering
  \includegraphics[#1,keepaspectratio]{#2}

  \vspace{0.15cm}

  \raggedright
  \scriptsize
  \textbf{图\theiqbfigure}：#3
}

% Two figures side by side with individual numbered captions
% Usage: \iqbtwofig[options]{img1}{caption1}{img2}{caption2}
\newcommand{\iqbtwofig}[5][height=0.45\textheight]{%
  \iqblayouttwo{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#2}

    \vspace{0.1cm}

    \raggedright
    \scriptsize
    \textbf{图\theiqbfigure}：#3
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#4}

    \vspace{0.1cm}

    \raggedright
    \scriptsize
    \textbf{图\theiqbfigure}：#5
  }
}

% Three figures in a row with captions
% Usage: \iqbthreefig[options]{img1}{caption1}{img2}{caption2}{img3}{caption3}
\newcommand{\iqbthreefig}[7][height=0.35\textheight]{%
  \iqblayoutthree{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#2}

    \vspace{0.1cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#3
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#4}

    \vspace{0.1cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#5
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#6}

    \vspace{0.1cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#7
  }
}

% 2x2 grid with numbered captions
% Usage: \iqbfourfig[options]{img1}{caption1}{img2}{caption2}{img3}{caption3}{img4}{caption4}
\newcommand{\iqbfourfig}[9][height=0.35\textheight]{%
  \iqbgridtwobytwo{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#2}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#3
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#4}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#5
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#6}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#7
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#8}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#9
  }
}

% ============================================================
% Legacy Image + Caption Utilities (for backward compatibility)
% ============================================================

% Image with caption below
\newcommand{\iqbfigure}[3][width=\textwidth]{%
  \begin{figure}
    \centering
    \includegraphics[#1]{#2}
    \ifx&#3&%
    \else
      \caption{#3}
    \fi
  \end{figure}
}

% Side-by-side images with individual captions
\newcommand{\iqbtwofigures}[6][width=0.45\textwidth]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      \begin{figure}
        \centering
        \includegraphics[#1]{#2}
        \ifx&#3&%
        \else
          \caption{#3}
        \fi
      \end{figure}
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      \begin{figure}
        \centering
        \includegraphics[#4]{#5}
        \ifx&#6&%
        \else
          \caption{#6}
        \fi
      \end{figure}
    \end{column}
  \end{columns}
}

% ============================================================
% Text + Image Layouts
% ============================================================

% Image on left, text on right
\newcommand{\iqbimagetext}[3][width=0.45\textwidth]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      \includegraphics[#1]{#2}
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      #3
    \end{column}
  \end{columns}
}

% Text on left, image on right
\newcommand{\iqbtextimage}[3][width=0.45\textwidth]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      #2
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      \includegraphics[#1]{#3}
    \end{column}
  \end{columns}
}

% ============================================================
% Precise Positioning (for irregular layouts - 10% usage)
% ============================================================

% Place content at precise coordinates
% Usage: \iqbplace{x}{y}{width}{content}
% Coordinates: (0,0) is top-left, units in cm
\newcommand{\iqbplace}[4]{%
  \begin{tikzpicture}[remember picture,overlay]
    \node[anchor=north west,inner sep=0pt] at ($(current page.north west) + (#1,-#2)$) {
      \begin{minipage}{#3}
        #4
      \end{minipage}
    };
  \end{tikzpicture}
}

% Place image at precise coordinates with size
% Usage: \iqbplaceimage{x}{y}{width}{height}{image-file}
\newcommand{\iqbplaceimage}[5]{%
  \begin{tikzpicture}[remember picture,overlay]
    \node[anchor=north west,inner sep=0pt] at ($(current page.north west) + (#1,-#2)$) {
      \includegraphics[width=#3,height=#4,keepaspectratio]{#5}
    };
  \end{tikzpicture}
}

% ============================================================
% Author Information Modules (Commonly used in JC papers)
% ============================================================

% Two authors with photos: Corresponding + First Author
% Usage: \iqbauthorstwophoto{corr-photo}{corr-name}{corr-affiliation}{corr-url}{corr-research}
%                            {first-photo}{first-name}{first-affiliation}{first-url}{first-field}
\newcommand{\iqbauthorstwophoto}[9]{%
  \iqblayouttwo{
    % Corresponding Author
    \begin{block}{通讯作者 (Corresponding Author)}
      \vspace{0.1cm}
      \begin{minipage}{0.25\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth,height=2.5cm,keepaspectratio]{#1}
      \end{minipage}%
      \hfill
      \begin{minipage}{0.70\textwidth}
        \textbf{\scriptsize #2}\\[0.1cm]
        \scriptsize #3\\[0.1cm]
        \textcolor{blue}{\scriptsize #4}\\[0.1cm]
        \textbf{\scriptsize 研究方向}：\\
        \scriptsize #5
      \end{minipage}
      \vspace{0.1cm}
    \end{block}
  }{
    % First Author
    \begin{block}{第一作者 (First Author)}
      \vspace{0.1cm}
      \begin{minipage}{0.25\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth,height=2.5cm,keepaspectratio]{#6}
      \end{minipage}%
      \hfill
      \begin{minipage}{0.70\textwidth}
        \textbf{\scriptsize #7}\\[0.1cm]
        \scriptsize #8\\[0.1cm]
        \textcolor{blue}{\scriptsize #9}\\[0.1cm]
        \textbf{\scriptsize 专业领域}：\\
        \scriptsize \iqbauthorfirstfield
      \end{minipage}
      \vspace{0.1cm}
    \end{block}
  }
}

% Helper command for first author field (to work around 9-param limit)
\newcommand{\iqbauthorfirstfield}{}
\newcommand{\setauthorfirstfield}[1]{\renewcommand{\iqbauthorfirstfield}{#1}}

% Two authors WITHOUT photos (original version)
% Usage: \iqbauthorstwo{corr-name}{corr-affiliation}{corr-url}{corr-research}
%                       {first-name}{first-affiliation}{first-url}{first-field}
\newcommand{\iqbauthorstwo}[8]{%
  \iqblayouttwo{
    % Corresponding Author
    \begin{block}{通讯作者 (Corresponding Author)}
      \vspace{0.15cm}
      \textbf{\scriptsize #1}\\[0.15cm]
      \scriptsize #2\\[0.15cm]
      \textcolor{blue}{\scriptsize #3}\\[0.15cm]
      \textbf{\scriptsize 研究方向}：\\
      \scriptsize #4
      \vspace{0.1cm}
    \end{block}
  }{
    % First Author
    \begin{block}{第一作者 (First Author)}
      \vspace{0.15cm}
      \textbf{\scriptsize #5}\\[0.15cm]
      \scriptsize #6\\[0.15cm]
      \textcolor{blue}{\scriptsize #7}\\[0.15cm]
      \textbf{\scriptsize 专业领域}：\\
      \scriptsize #8
      \vspace{0.1cm}
    \end{block}
  }
}

% Single author (e.g., solo paper or review)
% Usage: \iqbauthorone{name}{affiliation}{url}{research}
\newcommand{\iqbauthorone}[4]{%
  \begin{block}{作者 (Author)}
    \vspace{0.2cm}
    \centering
    \textbf{\scriptsize #1}\\[0.3cm]
    \scriptsize #2\\[0.2cm]
    \textcolor{blue}{\scriptsize #3}\\[0.3cm]
    \textbf{\scriptsize 研究方向}：\\
    \scriptsize #4
    \vspace{0.2cm}
  \end{block}
}

% Three authors layout (simplified - 3 authors info blocks)
% Usage: \iqbauthorsthree{author1-block}{author2-block}{author3-block}
% Each block should contain formatted author info
\newcommand{\iqbauthorsthree}[3]{%
  \iqblayoutthree{
    \begin{block}{\small 作者 1}
      \small
      #1
    \end{block}
  }{
    \begin{block}{\small 作者 2}
      \small
      #2
    \end{block}
  }{
    \begin{block}{\small 作者 3}
      \small
      #3
    \end{block}
  }
}

% ============================================================
% Enhanced Author Information Commands (增强作者信息模块)
% ============================================================
% 提供更灵活的作者信息展示，支持可选参数

% Single author WITH photo and optional email
% Usage: \iqbauthoronephoto{photo}{name}{affiliation}{url}{research}{email}
%        email可为空：\iqbauthoronephoto{photo}{name}{aff}{url}{research}{}
% 示例:
%   \iqbauthoronephoto{images/author.jpg}{张三}{清华大学}{https://example.com}{计算生物学}{zhangsan@tsinghua.edu.cn}
\newcommand{\iqbauthoronephoto}[6]{%
  \begin{block}{作者 (Author)}
    \vspace{0.15cm}
    \begin{minipage}{0.25\textwidth}
      \centering
      \includegraphics[width=0.9\textwidth,height=2.5cm,keepaspectratio]{#1}
    \end{minipage}%
    \hfill
    \begin{minipage}{0.70\textwidth}
      \textbf{\scriptsize #2}\\[0.1cm]
      \scriptsize #3\\[0.1cm]
      \textcolor{blue}{\scriptsize #4}\\[0.1cm]
      \ifx&#6&%  % 如果email为空
        % 不显示email
      \else%
        \textcolor{iqbgray}{\scriptsize \faEnvelope\ #6}\\[0.1cm]
      \fi%
      \textbf{\scriptsize 研究方向}：\\
      \scriptsize #5
    \end{minipage}
    \vspace{0.1cm}
  \end{block}
}

% Three authors WITH photos (compact layout)
% Usage: \iqbauthorsthreephoto{p1}{n1}{a1}{p2}{n2}{a2}{p3}{n3}{a3}
%        p=photo, n=name, a=affiliation
% 示例: 用于多位并列作者的紧凑展示
\newcommand{\iqbauthorsthreephoto}[9]{%
  \iqblayoutthree{
    \begin{block}{\small 作者 1}
      \vspace{0.1cm}
      \centering
      \includegraphics[width=0.7\textwidth,height=2cm,keepaspectratio]{#1}\\[0.15cm]
      \textbf{\scriptsize #2}\\[0.1cm]
      \scriptsize #3
      \vspace{0.1cm}
    \end{block}
  }{
    \begin{block}{\small 作者 2}
      \vspace{0.1cm}
      \centering
      \includegraphics[width=0.7\textwidth,height=2cm,keepaspectratio]{#4}\\[0.15cm]
      \textbf{\scriptsize #5}\\[0.1cm]
      \scriptsize #6
      \vspace{0.1cm}
    \end{block}
  }{
    \begin{block}{\small 作者 3}
      \vspace{0.1cm}
      \centering
      \includegraphics[width=0.7\textwidth,height=2cm,keepaspectratio]{#7}\\[0.15cm]
      \textbf{\scriptsize #8}\\[0.1cm]
      \scriptsize #9
      \vspace{0.1cm}
    \end{block}
  }
}

% Author information with optional fields helper
% 使用说明：对于更复杂的可选参数场景，推荐使用以下模式：
% 1. 定义临时变量存储可选信息
% 2. 使用 \iqbauthoronephoto 或 \iqbauthorstwo 等基础命令
% 3. 传递空参数给不需要的字段
%
% 示例:
%   \newcommand{\myauthor}[5][]{%  % #1=optional email
%     \iqbauthoronephoto{#2}{#3}{#4}{#5}{研究内容}{#1}
%   }
%
% 未来版本计划：使用pgfkeys实现完全可选的参数系统

% ============================================================
% Academic Badges and Icons (学术徽章与图标)
% ============================================================
% 用于显示作者的学术身份标识和社交链接
% 需要fontawesome5包支持（已在beamerthemeiqb.sty中加载）

% ORCID图标+ID（带超链接）
% Usage: \iqborcid{0000-0001-2345-6789}
% 效果: 显示ORCID图标和可点击的ID链接
\newcommand{\iqborcid}[1]{%
  \href{https://orcid.org/#1}{\faOrcid\ \textcolor{black}{#1}}%
}

% GitHub用户名链接
% Usage: \iqbgithub{username}
% 效果: GitHub图标 + username（可点击）
\newcommand{\iqbgithub}[1]{%
  \href{https://github.com/#1}{\faGithub\ #1}%
}

% Google Scholar链接（仅显示图标，需完整URL）
% Usage: \iqbgscholar{https://scholar.google.com/citations?user=XXXX}
% 效果: Google Scholar图标（可点击）
\newcommand{\iqbgscholar}[1]{%
  \href{#1}{\faGraduationCap\ Google Scholar}%
}

% Email链接（带图标）
% Usage: \iqbemail{someone@example.com}
% 效果: 信封图标 + email（可点击发送邮件）
\newcommand{\iqbemail}[1]{%
  \href{mailto:#1}{\faEnvelope\ #1}%
}

% Twitter/X链接
% Usage: \iqbtwitter{username}
% 效果: Twitter图标 + @username（可点击）
\newcommand{\iqbtwitter}[1]{%
  \href{https://twitter.com/#1}{\faTwitter\ @#1}%
}

% ResearchGate链接
% Usage: \iqbresearchgate{Full_Name}
% 效果: ResearchGate图标 + 链接
\newcommand{\iqbresearchgate}[1]{%
  \href{https://www.researchgate.net/profile/#1}{\faResearchgate\ ResearchGate}%
}

% 通用网站链接（带图标）
% Usage: \iqbwebsite{https://example.com}
% 效果: 地球图标 + Website
\newcommand{\iqbwebsite}[1]{%
  \href{#1}{\faGlobe\ Website}%
}

% 组合使用示例（在作者信息中）
% \iqbauthoronephoto{photo}{Name}{Affiliation}{\iqbwebsite{url}}{Research}{\iqbemail{email}}
% 或在文本中：\iqborcid{0000-0001-2345-6789} \iqbgithub{username}

% ============================================================
% Formula + Explanation Module (公式+解释布局)
% ============================================================

% Formula on left, explanation on right
% Usage: \iqbformulaexplain{formula-content}{explanation-text}
\newcommand{\iqbformulaexplain}[2]{%
  \iqblayoutonethird{
    \centering
    #1
  }{
    #2
  }
}

% ============================================================
% Key Points Module (关键要点提炼)
% ============================================================

% Highlighted key points block
% Usage: \iqbkeypoints{itemize-content}
\newcommand{\iqbkeypoints}[1]{%
  \begin{block}{{\color{iqbblue}\textbf{关键要点 (Key Points)}}}
    #1
  \end{block}
}

% ============================================================
% Comparison Table Module (对比表格)
% ============================================================

% Simple two-column comparison
% Usage: \iqbcomparetwo{method-a-title}{method-a-content}
%                       {method-b-title}{method-b-content}
\newcommand{\iqbcomparetwo}[4]{%
  \iqblayouttwo{
    \centering
    \textbf{#1}

    \vspace{0.2cm}

    #2
  }{
    \centering
    \textbf{#3}

    \vspace{0.2cm}

    #4
  }
}

% Three-column comparison
% Usage: \iqbcomparethree{titleA}{contentA}{titleB}{contentB}{titleC}{contentC}
\newcommand{\iqbcomparethree}[6]{%
  \iqblayoutthree{
    \centering
    \textbf{#1}

    \vspace{0.15cm}

    #2
  }{
    \centering
    \textbf{#3}

    \vspace{0.15cm}

    #4
  }{
    \centering
    \textbf{#5}

    \vspace{0.15cm}

    #6
  }
}

% ============================================================
% Timeline / Workflow Module (时间线/流程)
% ============================================================

% Three-step timeline with arrows
% Usage: \iqbtimeline{step1-title}{step1-content}
%                    {step2-title}{step2-content}
%                    {step3-title}{step3-content}
\newcommand{\iqbtimeline}[6]{%
  \begin{center}
  \begin{tikzpicture}[
    node distance=0.5cm,
    box/.style={rectangle, draw=iqbblue, fill=iqblightgray, thick, minimum height=2cm, minimum width=3.5cm, align=center},
    arrow/.style={->, >=stealth, thick, color=iqbblue}
  ]
    \node[box] (step1) {\textbf{\scriptsize #1}\\[0.2cm]\scriptsize #2};
    \node[box, right=of step1] (step2) {\textbf{\scriptsize #3}\\[0.2cm]\scriptsize #4};
    \node[box, right=of step2] (step3) {\textbf{\scriptsize #5}\\[0.2cm]\scriptsize #6};

    \draw[arrow] (step1.east) -- (step2.west);
    \draw[arrow] (step2.east) -- (step3.west);
  \end{tikzpicture}
  \end{center}
}

% ============================================================
% Conclusion / Summary Module (结论总结)
% ============================================================

% Centered conclusion block
% Usage: \iqbconclusion{conclusion-text}
\newcommand{\iqbconclusion}[1]{%
  \begin{block}{\centering \textbf{结论 (Conclusion)}}
    \centering
    #1
  \end{block}
}

% ============================================================
% Research Question Module (研究问题)
% ============================================================

% Highlighted research question
% Usage: \iqbquestion{question-text}
\newcommand{\iqbquestion}[1]{%
  \begin{block}{\centering \textbf{核心问题 (Research Question)}}
    \centering
    #1
  \end{block}
}

% ============================================================
% Advanced Shortcuts (高级快捷命令 - Phase 1 增强)
% 用于快速创建常见frame模式，减少代码重复
% ============================================================

% ============================================================
% Frame Shortcuts (Frame快捷命令)
% ============================================================

% 标准单栏frame
% Usage: \iqbframe{标题}{内容}
\newcommand{\iqbframe}[2]{%
  \begin{frame}{#1}
    #2
  \end{frame}
}

% 文字+图片左右分栏frame (文字占1/3，图片占2/3)
% Usage: \iqbframetextfig{标题}{文字内容}{图片路径}
%   或: \iqbframetextfig[0.6\textheight]{标题}{文字内容}{图片路径}
%   或: \iqbframetextfig[0.6\textheight]{标题}{文字内容}{图片路径}{图注}
% 新增: 第5个参数用于图片下的图注（可选）
\newcommand{\iqbframetextfig}[5][0.55\textheight]{%
  \begin{frame}{#2}
    \iqblayoutonethird{%
      #3%
    }{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#4}%
      \ifx&#5&%
        % 没有提供图注
      \else
        % 提供了图注，显示在图片下
        \medskip
        \iqbcaptiontext{#5}%
      \fi
    }%
  \end{frame}
}

% 图片+文字左右分栏frame (图片占1/3，文字占2/3)
% Usage: \iqbframefigttext{标题}{图片路径}{文字内容}
%   或: \iqbframefigttext[0.6\textheight]{标题}{图片路径}{文字内容}
\newcommand{\iqbframefigttext}[4][0.55\textheight]{%
  \begin{frame}{#2}
    \iqblayouttwothirds{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#3}%
    }{%
      #4%
    }%
  \end{frame}
}

% 文字+两个图片frame (文字占1/3，两个图片并排占2/3)
% Usage: \iqbframetexttwofig{标题}{文字}{img1}{caption1}{img2}{caption2}
%   或: \iqbframetexttwofig[0.45\textheight]{标题}{文字}{img1}{cap1}{img2}{cap2}
\newcommand{\iqbframetexttwofig}[7][0.45\textheight]{%
  \begin{frame}{#2}
    \iqblayoutonethird{%
      #3%
    }{%
      \iqbtwofig[height=#1]{#4}{#5}{#6}{#7}%
    }%
  \end{frame}
}

% ============================================================
% Section Management (Section管理命令)
% ============================================================

% 自动生成section分隔页，无需手动 \setsection
% Usage: \iqbsectionframe{Methods}{方法}
%   参数1: section英文名 (用于footer)
%   参数2: 分隔页显示的中文标题
\newcommand{\iqbsectionframe}[2]{%
  \setsection{#1}%
  \begin{frame}[plain,noframenumbering]
    % 背景：浅蓝色渐变 (白 → 淡蓝)
    \begin{tikzpicture}[remember picture,overlay]
      \fill[white] (current page.south west) rectangle (current page.north east);
      \shade[left color=white, right color=iqblightgray!30] (current page.south west) rectangle (current page.north east);
    \end{tikzpicture}

    % 左侧装饰条（竖线）
    \begin{tikzpicture}[remember picture,overlay]
      \draw[line width=8pt, color=iqbblue] (current page.north west) -- (current page.south west);
    \end{tikzpicture}

    % 右下角装饰（protein图案）
    \begin{tikzpicture}[remember picture,overlay]
      \node[anchor=south east, inner sep=0pt, opacity=0.12] at ($(current page.south east) + (-1cm, 1cm)$) {
        \includegraphics[height=5cm,keepaspectratio]{../theme/images/protein.png}
      };
    \end{tikzpicture}

    % 标题文字 + 英文副标题
    \begin{tikzpicture}[remember picture,overlay]
      \node[anchor=center] at ($(current page.center) + (0, 0.5cm)$) {
        \begin{minipage}{0.8\paperwidth}
          \centering
          {\Huge\color{iqbblue}\textbf{#2}}\\[0.3cm]
          {\Large\color{iqbgray}#1}
        \end{minipage}
      };
    \end{tikzpicture}

    % 底部装饰线
    \begin{tikzpicture}[remember picture,overlay]
      \draw[line width=1.5pt, color=iqbblue] ($(current page.south west) + (0.5cm, 0.8cm)$) -- ($(current page.south east) + (-0.5cm, 0.8cm)$);
    \end{tikzpicture}
  \end{frame}
}

% ============================================================
% Formula + Explanation Layout (公式+解释专用布局)
% ============================================================

% 单个公式块 (包含标题+公式+解释，自动间距管理)
% Usage: \iqbformblock{标题}{公式内容}{解释文字}
% 示例:
%   \iqbformblock{成核部分 $\text{CV}_{\text{cyl}}$}{
%     $$\text{CV}_{\text{cyl}} = 1 - d/\text{CV}_{\text{eq}}$$
%   }{$d$: 圆柱内脂质尾部原子数}
\newcommand{\iqbformblock}[3]{%
  \textbf{#1}：\\*[-0.1cm]
  \vspace{0.05cm}

  #2  % 公式

  \vspace{0.05cm}

  {\footnotesize #3}  % 解释

  \smallskip
}

% 公式+解释Frame (左侧1/3公式/代码，右侧2/3图片或文字)
% Usage: \iqbformulaframe{标题}{左侧公式内容}{右侧内容}
% 示例:
%   \iqbformulaframe{Full-Path CV原理}{
%     \iqbformblock{成核}{$$\text{CV}_{\text{cyl}} = ...$$}{解释}
%     \iqbformblock{扩展}{$$\text{CV}_{\text{radius}} = ...$$}{解释}
%   }{
%     \iqbfig[height=0.55\textheight]{图片.png}{图注}
%   }
\newcommand{\iqbformulaframe}[3]{%
  \begin{frame}{#1}
    \iqblayoutonethird{#2}{#3}%
  \end{frame}
}

% ============================================================
% Three-Column Comparison Template (三列对比专用)
% ============================================================

% 三列对比 (标题+图片+列表的标准模式)
% Usage: \iqbthreecolcompare{title1}{img1}{items1}{title2}{img2}{items2}{title3}{img3}{content3}
%   参数: title=标题，img=图片路径，items=\item 列表项，content=文字内容
% 示例:
%   \iqbthreecolcompare
%     {Full-Path CV}{fig1u.png}{\item 成核+扩展 \item 无滞后}
%     {Rapid CV}{fig1d.png}{\item 无限孔 \item 高效}
%     {开源实现}{plumed.png}{PLUMED库\\GROMACS/LAMMPS}
\newcommand{\iqbthreecolcompare}[9]{%
  \iqblayoutthree{%
    \centering
    \textbf{#1}

    \medskip

    \includegraphics[width=\textwidth]{#2}

    \medskip

    \begin{itemize}
      #3
    \end{itemize}
  }{%
    \centering
    \textbf{#4}

    \medskip

    \includegraphics[width=\textwidth]{#5}

    \medskip

    \begin{itemize}
      #6
    \end{itemize}
  }{%
    \centering
    \textbf{#7}

    \medskip

    \includegraphics[width=\textwidth,height=0.4\textheight,keepaspectratio]{#8}

    \medskip

    \begin{itemize}
      #9
    \end{itemize}
  }%
}

% ============================================================
% Block Shortcuts (块级快捷命令)
% ============================================================

% 快速创建block
% Usage: \iqbblock{标题}{内容}
\newcommand{\iqbblock}[2]{%
  \begin{block}{#1}
    #2
  \end{block}
}

% 设置列表缩进（在 iqbitemize 前使用）
% Usage: \setiqbitemizeindent{1cm}
%        \begin{iqbitemize} ... \end{iqbitemize}
\newcommand{\setiqbitemizeindent}[1]{%
  \setlength{\leftmargini}{#1}%
}

% 快速创建列表（支持缩进，自动标签加粗蓝色）
% Usage: \begin{iqbitemize} \item[标签] 内容 \end{iqbitemize}
%        或: \item 不带标签的项
%        标签会自动加粗并变为 IQB 蓝色
\newenvironment{iqbitemize}[1][0em]{%
  \leavevmode\hspace*{#1}%
  \begin{minipage}[t]{\dimexpr\linewidth - #1\relax}%
  \begin{itemize}%
  % 重定义 \item 命令以处理可选参数（支持带标签和不带标签）
  \let\iqbolditem\item%
  % 使用 \@ifnextchar 检测是否有 [ 参数
  \def\item{%
    \@ifnextchar[%
      {\iqb@item@withopt}%
      {\iqbolditem}%
  }%
  % 处理有可选参数的情况
  \def\iqb@item@withopt[##1]{%
    \iqbolditem[\textcolor{iqbblue}{\textbf{##1}}]%
  }%
}{%
  \end{itemize}%
  \end{minipage}%
}

% 快速创建描述列表（适合较长标签，支持标签右对齐）
% Usage: \begin{iqbdescription} ... \end{iqbdescription}
%        \begin{iqbdescription}[2.5cm] ... \end{iqbdescription}  (向右移动2.5cm)
%        标签会自动加粗并变为 IQB 蓝色，标签在1cm宽度内右对齐
%        适合4-6字的较长标签；短标签或无标签列表请使用 iqbitemize
\newenvironment{iqbdescription}[1][0em]{%
  \leavevmode\hspace*{#1}%
  \begin{minipage}[t]{\dimexpr\linewidth - #1\relax}%
  \begin{itemize}%
  % 设置标签宽度为1cm，实现右对齐显示长标签
  \setlength{\labelwidth}{1cm}%
  \setlength{\leftmargini}{1.2cm}%
  % 重定义标签显示方式：右对齐，蓝色加粗
  \def\makelabel##1{\makebox[1cm][r]{\textcolor{iqbblue}{\textbf{##1}}}}%
  % 重定义 \item 命令以处理可选参数（支持带标签和不带标签）
  \let\iqbolditem\item%
  % 使用 \@ifnextchar 检测是否有 [ 参数
  \def\item{%
    \@ifnextchar[%
      {\iqb@desc@item@withopt}%
      {\iqbolditem}%
  }%
  % 处理有可选参数的情况
  \def\iqb@desc@item@withopt[##1]{%
    \iqbolditem[##1]%
  }%
}{%
  \end{itemize}%
  \end{minipage}%
}

% 快速创建编号列表
% Usage: \iqbenumerate{\item 项1 \item 项2}
\newcommand{\iqbenumerate}[1]{%
  \begin{enumerate}
    #1
  \end{enumerate}
}

% ============================================================
% Two-Method Comparison Layout (双方法对比)
% ============================================================

% 两列对比 (标题+图片+列表)
% Usage: \iqbtwocolcompare{title1}{img1}{items1}{title2}{img2}{items2}
%   或仅文字版: \iqbtwocolcompare{title1}{}{text1}{title2}{}{text2}
\newcommand{\iqbtwocolcompare}[6]{%
  \iqblayouttwo{%
    \centering
    \textbf{#1}

    \medskip

    \ifx&#2&%
      % 无图片，仅显示文字
      #3
    \else
      % 有图片
      \includegraphics[width=\textwidth]{#2}

      \medskip

      \begin{itemize}#3\end{itemize}
    \fi
  }{%
    \centering
    \textbf{#4}

    \medskip

    \ifx&#5&%
      % 无图片，仅显示文字
      #6
    \else
      % 有图片
      \includegraphics[width=\textwidth]{#5}

      \medskip

      \begin{itemize}#6\end{itemize}
    \fi
  }%
}

% ============================================================
% Validation/Results Layout (验证结果专用布局)
% ============================================================

% 结果展示frame (左侧1/3文字，右侧2/3图片)
% Usage: \iqbresultframe{标题}{左侧文字}{右侧图片}
% 自动应用合适的字体大小和间距
\newcommand{\iqbresultframe}[3]{%
  \begin{frame}{#1}
    \iqblayoutonethird{%
      \footnotesize
      #2
    }{%
      \centering
      \includegraphics[height=0.65\textheight,keepaspectratio]{#3}
    }%
  \end{frame}
}

% 对比结果frame (两个并排结果展示)
% Usage: \iqbcomparisonframe{标题}{左图}{左标题}{右图}{右标题}
\newcommand{\iqbcomparisonframe}[5]{%
  \begin{frame}{#1}
    \iqbtwofig[height=0.55\textheight]{#2}{#3}{#4}{#5}%
  \end{frame}
}

% ============================================================
% Paper Metadata Commands (论文元数据预定义)
% ============================================================

% 初始化论文元数据存储变量
\newcommand{\papertitle}[1]{\def\@papertitle{#1}}
\newcommand{\paperengtitle}[1]{\def\@paperengtitle{#1}}
\newcommand{\papercitation}[1]{\def\@papercitation{#1}}
\newcommand{\paperdoi}[1]{\def\@paperdoi{#1}}
\newcommand{\paperjournal}[1]{\def\@paperjournal{#1}}
\newcommand{\correspondingauthor}[2]{\def\@corrauthor{#1}\def\@corraffil{#2}}
\newcommand{\firstauthor}[2]{\def\@firstauthor{#1}\def\@firstaffil{#2}}
\newcommand{\paperyear}[1]{\def\@paperyear{#1}}

% 设置默认值
\def\@papertitle{论文标题}
\def\@paperengtitle{Paper Title}
\def\@papercitation{Full Citation}
\def\@paperdoi{DOI}
\def\@paperjournal{Journal}
\def\@corrauthor{通讯作者}
\def\@corraffil{所属单位}
\def\@firstauthor{第一作者}
\def\@firstaffil{所属单位}
\def\@paperyear{\the\year}

% ============================================================
% Paper Metadata Display (论文元数据显示宏)
% ============================================================

% 显示发表信息（期刊+年份、体积、页码 | DOI）
% Usage: \iqbpublicationinfo
% 需预先定义: \paperdoi{...}
\newcommand{\iqbpublicationinfo}{%
  \textbf{发表}: \textit{J. Chem. Inf. Model.} \textbf{65}, 908–920 (2025) | \textbf{DOI}: \@paperdoi
}

% ============================================================
% Thank You Frame (致谢页 - 固定样式)
% ============================================================

% 致谢页frame（自动使用已定义的论文引用）
% Usage: \iqbthankyouframe
% 或指定自定义引用: \iqbthankyouframe[自定义引用文本]
\newcommand{\iqbthankyouframe}[1][\@papercitation]{%
  \begin{frame}[plain]
    \vfill
    \centering

    {\Huge \textcolor{iqbblue}{\textbf{Thanks for Listening!}}}

    \bigskip

    {\Large Questions?}

    \bigskip\bigskip

    {\normalsize
    \textbf{参考文献}：\\[0.2cm]
    #1
    }

    \vfill
  \end{frame}
}

% ============================================================
% Chinese Title Metadata (中文标题配置)
% ============================================================

% 中文主标题
% Usage: \papertitlechn{破解膜孔之谜：双CV联手揭示}
\newcommand{\papertitlechn}[1]{\def\@papertitlechn{#1}}

% 中文副标题
% Usage: \papertitlechnsub{从成核到扩展的完整能量图景}
\newcommand{\papertitlechnsub}[1]{\def\@papertitlechnsub{#1}}

% 设置默认值
\def\@papertitlechn{论文中文标题}
\def\@papertitlechnsub{论文中文副标题}

% ============================================================
% Caption Text Styling (图注样式复用)
% ============================================================

% 标准图注样式 (footnotesize + 左对齐 + 灵活右边距)
% Usage: \iqbcaptiontext{图注内容}
% 自动应用: \footnotesize + \raggedright + \setlength{\rightskip}{0pt plus 1cm}
\newcommand{\iqbcaptiontext}[1]{%
  {\footnotesize\raggedright\setlength{\rightskip}{0pt plus 1cm}
  #1
  }%
}

% 紧凑型图注 (用于多个小图的情况)
% Usage: \iqbcaptiontextsmall{内容}
\newcommand{\iqbcaptiontextsmall}[1]{%
  {\tiny\raggedright\setlength{\rightskip}{0pt plus 1cm}
  #1
  }%
}

% ============================================================
% Figure with Caption (居中图片+左对齐图注)
% ============================================================
% 标准图+图注模式：自动居中图片，图注左对齐且自动换行
% Usage: \iqbfigcap[图片选项]{图片路径}{图注内容}
% 默认图片高度: height=0.5\textheight（可通过可选参数覆盖）
% 例子：\iqbfigcap[width=0.9\textwidth]{path/to/image.png}{图注文本}
\newcommand{\iqbfigcap}[3][height=0.5\textheight]{%
  \begin{figure}[htbp]
    \centering
    \includegraphics[#1,keepaspectratio]{#2}
    \par\vskip0.2cm
    \begin{minipage}{0.9\linewidth}
      \iqbcaptiontext{#3}%
    \end{minipage}
  \end{figure}
}

% ============================================================
% Table Utilities (表格快捷命令)
% ============================================================

% 三线表 (使用booktabs风格)
% Usage: \iqbthreelinetable{标题}{表头 & 内容 \\}{表体行 & 内容 \\ ...}
% 示例:
%   \iqbthreelinetable{力场表现（孔寿命/ns）}{
%     力场 & DMPC & DPPC & POPC & DOPC \\
%   }{
%     C36     & 122 & 94 & 34 & 15 \\
%     Slipids & 110 & 32 & 27 & 18 \\
%   }
\newcommand{\iqbthreelinetable}[3]{%
  \vspace{-0.3cm}
  \begin{center}
  {\scriptsize
  \textbf{#1}
  \vspace{-0.05cm}

  \begin{tabular}[t]{lcccc}
    \toprule
    #2
    \midrule
    #3
    \bottomrule
  \end{tabular}
  }
  \end{center}
  \vspace{-0.3cm}
}

% 两列对比表 (简化版, 用于条件对比)
% Usage: \iqbtwocoltable{列1标题}{列2标题}{行1 & 值1 \\ 行2 & 值2 \\}
% 示例:
%   \iqbtwocoltable{脂质类型}{$\Delta\gamma$ 变化}{
%     POPG/POPS & ↑30-50\% \\
%     POPC/POPE & ≈0 \\
%   }
\newcommand{\iqbtwocoltable}[3]{%
  {\footnotesize
  \centering
  \begin{tabular}{lc}
    \toprule
    \textbf{#1} & \textbf{#2} \\
    \midrule
    #3
    \bottomrule
  \end{tabular}
  }%
}

% 多列表格 (通用版本，可自定义列数和列格式)
% Usage: \iqbmulticoltable{表头}{行1 \\ 行2 \\}
% 注: 需要在调用前定义列格式
% 示例:
%   \iqbmulticoltable{条件 & 结果 & 准确性 \\}{
%     Full-Path & 0.82 & 高 \\
%     Rapid     & 0.81 & 中 \\
%   }
\newcommand{\iqbmulticoltable}[2]{%
  {\footnotesize
  \centering
  \begin{tabular}{lll}
    \toprule
    #1
    \midrule
    #2
    \bottomrule
  \end{tabular}
  }%
}

% ============================================================
% Special Image Layout Commands (特殊图片布局)
% ============================================================

% 1:2 图文布局 (图片占1/3左侧，文字占2/3右侧)
% 用于特高竖版图，图注写在文字栏
% Usage: \iqbframeonethirdfig{标题}{左侧图片}{右侧文字}
%   或: \iqbframeonethirdfig[0.65\textheight]{标题}{左侧图片}{右侧文字}
\newcommand{\iqbframeonethirdfig}[4][0.65\textheight]{%
  \begin{frame}{#2}
    \iqblayoutonethird{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#3}%
    }{%
      \footnotesize
      #4%
    }%
  \end{frame}
}

% 2:1 图文布局 (文字占1/3左侧，图片占2/3右侧)
% 用于宽图，图注写在图片下方
% Usage: \iqbframetwothirdsfig{标题}{左侧文字}{右侧图片}
%   或: \iqbframetwothirdsfig[0.55\textheight]{标题}{左侧文字}{右侧图片}
\newcommand{\iqbframetwothirdsfig}[4][0.55\textheight]{%
  \begin{frame}{#2}
    \iqblayouttwothirds{%
      \footnotesize
      #3%
    }{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#4}%
    }%
  \end{frame}
}

% 特高竖版图 (图占1列，下方带图注)
% 用于像fig5c这样需要 1:1 或竖版显示且图注在下方的情况
% Usage: \iqbframefigcaption{标题}{图片路径}{图注文字}
%   或: \iqbframefigcaption[0.6\textheight]{标题}{图片路径}{图注文字}
\newcommand{\iqbframefigcaption}[4][0.6\textheight]{%
  \begin{frame}{#2}
    \centering
    \includegraphics[height=#1,keepaspectratio]{#3}

    \medskip

    \iqbcaptiontext{#4}%
  \end{frame}
}

% ============================================================
% P0 Priority Commands (Phase 1.5 高级增强)
% ============================================================

% ============================================================
% 封面页一行式模板 (Cover Frame Template)
% ============================================================

% 快速生成封面页（自动从元数据读取）
% Usage: \iqbcoverframe
% 自动使用已定义的元数据：\papertitlechn, \papertitlechnsub, \author, \institute, \date
\newcommand{\iqbcoverframe}{%
  \begin{frame}[plain,noframenumbering]
    \vfill
    \centering

    {\LARGE\textcolor{iqbblue}{\textbf{\@papertitlechn}}}\\[0.3cm]%
    {\LARGE\textcolor{iqbblue}{\textbf{\@papertitlechnsub}}}\\

    \medskip

    {\large \@paperengtitle}

    \bigskip

    {\normalsize \insertauthor}\\[0.2cm]%
    {\normalsize \insertinstitute}\\[0.2cm]%
    {\normalsize \insertdate}

    \vfill
  \end{frame}
}

% ============================================================
% 高亮发现块 (Highlight Findings)
% ============================================================

% 用于突出核心发现、临界结论等
% Usage: \iqbhighlight{标题}{核心内容}{强调语}
% 示例:
%   \iqbhighlight{临界发现}{
%     脂质尾部密度 $\leftrightarrow$ 孔寿命 $\tau$ (R²=0.82)
%   }{相关性极强！}
\newcommand{\iqbhighlight}[3]{%
  \textbf{#1}：\\*
  {\color{iqbblue}\textbf{#2}}

  \smallskip

  {\itshape #3}
}

% ============================================================
% 分步骤列表 (Step-by-step List)
% ============================================================

% 内部计数器
\newcounter{iqbstep}

% 重置计数器的辅助命令
\newcommand{\resetiqbstep}{\setcounter{iqbstep}{0}}

% 单个步骤
% Usage: \step{标签}{描述}
\newcommand{\step}[2]{%
  \item \textbf{#1}：#2
}

% 分步骤列表（带自动编号和间距管理）
% Usage: \iqbsteplist{标题}{步骤列表}
% 示例:
%   \iqbsteplist{四阶段闭合动力学}{
%     \step{(A) 平衡孔}{初始稳定孔，连续水柱贯穿膜厚度}
%     \step{(B) 半径缩小}{孔边缘脂质重排，整体结构保持不变}
%   }
\newcommand{\iqbsteplist}[2]{%
  \textbf{#1}：

  \smallskip

  \begin{itemize}
    #2
  \end{itemize}
}

% ============================================================
% P1 Priority Commands
% ============================================================

% ============================================================
% 带色彩强调的列表 (Color-highlighted List)
% ============================================================

% 用于展示带颜色强调的分类列表（如：✓准确 / ~部分正确 / ✗失败）
% Usage: \iqbcolorlist[颜色]{标题}{列表项}
% 颜色可选：green!60!black, orange, red 等
% 示例:
%   \iqbcolorlist[green!60!black]{力场表现}{
%     \item {\color{green!60!black}\textbf{C36/prosECCo75}}：准确（NMR调参精细）
%     \item {\color{orange}\textbf{Slipids/M2.2p}}：部分正确
%   }
\newcommand{\iqbcolorlist}[3][blue]{%
  \textbf{#2}：

  \smallskip

  \begin{itemize}
    #3
  \end{itemize}
}

% ============================================================
% Bullet 列表快捷命令 (Bullet List Shortcut)
% ============================================================

% 简化 bullet 列表的书写，自动处理间距
% Usage: \iqbbulletlist{标题}{子项}
% 其中子项使用 \item 或 \line 定义
% 示例:
%   \iqbbulletlist{线张力计算}{
%     \item Full-Path CV: 成核+扩展全过程
%     \item Rapid CV: 快速评估大孔极限
%   }
\newcommand{\iqbbulletlist}[2]{%
  \textbf{#1}\\

  \begin{itemize}
    #2
  \end{itemize}
}

% ============================================================
% 增强型公式参数块 (Enhanced Formula Parameter Block)
% ============================================================

% 参数行（在公式块中使用）
% Usage: \param{符号/公式}{说明}
\newcommand{\param}[2]{%
  $#1$ & \text{：} #2 \\
}

% 增强型公式块（包含参数表格化展示）
% Usage: \iqbformparam{公式名}{公式}{参数列表}
% 示例:
%   \iqbformparam{切换函数}{
%     s_1 = \frac{1}{1 + e^{\alpha(\text{CV}_r - \text{CV}_0)}}
%   }{
%     \param{\alpha = 20}{陡峭}
%     \param{\text{CV}_0 = 0.95}{切换点}
%   }
\newcommand{\iqbformparam}[3]{%
  \textbf{#1}：\\*[-0.1cm]
  \vspace{0.05cm}

  \centering
  #2  % 公式

  \vspace{0.05cm}

  \raggedright
  {\footnotesize
  \begin{tabular}{rl}
    #3
  \end{tabular}
  }

  \smallskip
}

% ============================================================
% P0: Visual Hierarchy Enhancement (视觉层次增强)
% ============================================================
% 这些命令帮助创建清晰的视觉层次，引导观众注意力到关键信息

% ============================================================
% 数据与结论强调 (Data & Findings Emphasis)
% ============================================================

% 强调关键数据（大号蓝色加粗）
% Usage: 线张力：\emphdata{34.1 pN}
% 效果：显著大于周围文字，IQB蓝色，粗体
\newcommand{\emphdata}[1]{{\Large\color{iqbblue}\textbf{#1}}}

% 高亮关键发现（黄色背景）
% Usage: \keyfinding{双CV方法高度一致}
% 效果：黄色背景高亮，黑色加粗文字
\newcommand{\keyfinding}[1]{\colorbox{yellow!30}{\textbf{#1}}}

% ============================================================
% Punchline 居中强调 (Centered Emphasis Punchlines)
% ============================================================
% 灵活的居中punchline系统，支持多种样式和颜色
% 适用场景：页面结论、核心发现、关键观点、学术申请陈述等

% 基础命令：简单居中强调 (支持颜色参数，默认蓝色)
% Usage: \iqbpunchline[orange]{计算驱动创新，精准设计引领药物研发新方向！}
%    或: \iqbpunchline{核心观点}  (默认蓝色)
% ============================================================
% 内部辅助命令 - 实现不同的样式组合
% ============================================================

% 无框，居中对齐
\newcommand{\@iqbpunchline@center}[2]{%
  \begin{center}
    {\large\color{#1}\textbf{#2}}
  \end{center}
}

% 无框，左对齐（多行文本）
\newcommand{\@iqbpunchline@left}[2]{%
  \raggedright
  {\large\color{#1}\textbf{#2}}
  \par
}

% 有框，居中对齐
\newcommand{\@iqbpunchline@boxcenter}[2]{%
  \begin{center}
    \colorbox{#1!15}{%
      \parbox{0.85\textwidth}{%
        \centering
        {\large\color{#1}\textbf{#2}}
      }%
    }
  \end{center}
}

% 有框，左对齐
\newcommand{\@iqbpunchline@boxleft}[2]{%
  \colorbox{#1!15}{%
    \parbox{0.95\textwidth}{%
      {\large\color{#1}\textbf{#2}}
    }%
  }
  \par
}

% ============================================================
% 基础命令：\iqbpunchline[color]{text}
% ============================================================
% 简单易用，默认居中
% Usage: \iqbpunchline[iqbgreen]{文本}
\newcommand{\iqbpunchline}[2][iqbblue]{%
  \@iqbpunchline@center{#1}{#2}%
}

% ============================================================
% 色彩快捷命令 - 支持可选参数 [选项]
% ============================================================
% 参数说明：
%   默认（空）：无框，居中对齐
%   [l]：无框，左对齐
%   [b]：有框，居中对齐
%   [bl]或[lb]：有框，左对齐

% 蓝色punchline（核心观点、主要发现）
% Usage: \iqbpunchlineblue{文本}
%   或: \iqbpunchlineblue[l]{多行文本}
%   或: \iqbpunchlineblue[b]{文本}
%   或: \iqbpunchlineblue[bl]{多行+框}
\newcommand{\iqbpunchlineblue}[2][]{%
  \def\@punchopt{#1}%
  \ifx\@punchopt\empty
    \@iqbpunchline@center{iqbblue}{#2}%
  \else
    \expandafter\@iqbpunchlineparse@iqbblue\expandafter{\@punchopt}{#2}%
  \fi
}

% 绿色punchline（成功验证、正面结果）
% 参数用法同蓝色
\newcommand{\iqbpunchlinegreen}[2][]{%
  \def\@punchopt{#1}%
  \ifx\@punchopt\empty
    \@iqbpunchline@center{iqbgreen}{#2}%
  \else
    \expandafter\@iqbpunchlineparse@iqbgreen\expandafter{\@punchopt}{#2}%
  \fi
}

% 橙色punchline（警示、挑战、需要关注）
% 参数用法同蓝色
\newcommand{\iqbpunchlineorange}[2][]{%
  \def\@punchopt{#1}%
  \ifx\@punchopt\empty
    \@iqbpunchline@center{iqborange}{#2}%
  \else
    \expandafter\@iqbpunchlineparse@iqborange\expandafter{\@punchopt}{#2}%
  \fi
}

% ============================================================
% 参数解析辅助宏
% ============================================================

\newcommand{\@iqbpunchlineparse@iqbblue}[2]{%
  % #1=选项, #2=文本
  \ifx#1b%
    \@iqbpunchline@boxcenter{iqbblue}{#2}%
  \else\ifx#1l%
    \@iqbpunchline@left{iqbblue}{#2}%
  \else\ifx#1B%
    \@iqbpunchline@boxcenter{iqbblue}{#2}%
  \else\ifx#1L%
    \@iqbpunchline@left{iqbblue}{#2}%
  \else
    % 处理 "bl" 或 "lb"
    \def\@tempbl{bl}\def\@templb{lb}\def\@temptest{#1}%
    \ifx\@temptest\@tempbl
      \@iqbpunchline@boxleft{iqbblue}{#2}%
    \else\ifx\@temptest\@templb
      \@iqbpunchline@boxleft{iqbblue}{#2}%
    \else
      \@iqbpunchline@center{iqbblue}{#2}%
    \fi\fi
  \fi\fi\fi\fi
}

\newcommand{\@iqbpunchlineparse@iqbgreen}[2]{%
  \ifx#1b%
    \@iqbpunchline@boxcenter{iqbgreen}{#2}%
  \else\ifx#1l%
    \@iqbpunchline@left{iqbgreen}{#2}%
  \else\ifx#1B%
    \@iqbpunchline@boxcenter{iqbgreen}{#2}%
  \else\ifx#1L%
    \@iqbpunchline@left{iqbgreen}{#2}%
  \else
    \def\@tempbl{bl}\def\@templb{lb}\def\@temptest{#1}%
    \ifx\@temptest\@tempbl
      \@iqbpunchline@boxleft{iqbgreen}{#2}%
    \else\ifx\@temptest\@templb
      \@iqbpunchline@boxleft{iqbgreen}{#2}%
    \else
      \@iqbpunchline@center{iqbgreen}{#2}%
    \fi\fi
  \fi\fi\fi\fi
}

\newcommand{\@iqbpunchlineparse@iqborange}[2]{%
  \ifx#1b%
    \@iqbpunchline@boxcenter{iqborange}{#2}%
  \else\ifx#1l%
    \@iqbpunchline@left{iqborange}{#2}%
  \else\ifx#1B%
    \@iqbpunchline@boxcenter{iqborange}{#2}%
  \else\ifx#1L%
    \@iqbpunchline@left{iqborange}{#2}%
  \else
    \def\@tempbl{bl}\def\@templb{lb}\def\@temptest{#1}%
    \ifx\@temptest\@tempbl
      \@iqbpunchline@boxleft{iqborange}{#2}%
    \else\ifx\@temptest\@templb
      \@iqbpunchline@boxleft{iqborange}{#2}%
    \else
      \@iqbpunchline@center{iqborange}{#2}%
    \fi\fi
  \fi\fi\fi\fi
}

% ============================================================
% 向后兼容的别名命令
% ============================================================
\newcommand{\iqbpunchlineboxgreen}[1]{\iqbpunchlinegreen[b]{#1}}
\newcommand{\iqbpunchlineboxorange}[1]{\iqbpunchlineorange[b]{#1}}
\newcommand{\iqbpunchlinebox}[2][iqbblue]{\iqbpunchline[#1]{#2}}

% ============================================================
% 页面标题命令 (Page Title Commands)
% ============================================================
% 用于plain页面的大标题（如"个人承诺"、"感谢"、"致谢"等）
% Usage: \iqbpagetitle{标题文字}
% 效果：Large字号 (14.4pt) + IQB蓝色 + 加粗
\newcommand{\iqbpagetitle}[1]{%
  {\Large\textcolor{iqbblue}{\textbf{#1}}}%
}

% 页面内段落标题命令 (Section Title Command - NEW)
% ============================================================
% 用于页面内的段落小标题（如"FEbuilder - 高通量自由能计算体系搭建工具"）
% 相比frametitle (12pt) 较小，比正文 (9pt) 较大，用于分组说明
% Usage: \iqbsectiontitle{标题文字}          或  \iqbsectiontitle[颜色]{标题文字}
% 效果：normalsize字号 (11pt) + IQB蓝色（默认） + 加粗，支持可选颜色参数
\newcommand{\iqbsectiontitle}[2][iqbblue]{%
  {\normalsize\textcolor{#1}{\textbf{#2}}}\vspace{-0.5em}%
}

% ============================================================
% 标签列表环境 (Labeled Itemize Environment)
% ============================================================
% 自动为\item[标签]中的标签添加加粗和颜色（默认iqbblue）
%
% Usage:
%   \begin{iqbitemize}
%     \item[标签1] 内容...
%     \item[标签2] 内容...
%   \end{iqbitemize}
%
% 可选参数：indent=long 用于长标签缩进
%   \begin{iqbitemize}[indent=long]
%     \item[长标签] 内容...
%   \end{iqbitemize}

% ============================================================
% Punchline 彩色框 (Colored Highlight Boxes)
% ============================================================
% 用于突出页面的核心观点、警示或成功验证
% 建议：每页最多使用1个punchline框

% 蓝色核心观点框（最常用）
% Usage: \iqbbluebox{标题}{内容}
% 适用：核心问题、主要发现、关键方法
\newcommand{\iqbbluebox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
  {\setbeamerfont{block title}{size=\footnotesize}%
   \begin{block}{\textbf{#1}}
     #2
   \end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%  % 保持默认
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

% 橙色警示框
% Usage: \iqborangebox{标题}{内容}
% 适用：挑战、限制、需注意的问题
\newcommand{\iqborangebox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqborange}%
  \setbeamercolor{block body}{fg=black,bg=iqborange!10}%
  {\setbeamerfont{block title}{size=\footnotesize}%
   \begin{block}{\textbf{#1}}
     #2
   \end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%  % 恢复默认
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

% 绿色成功框
% Usage: \iqbgreenbox{标题}{内容}
% 适用：验证通过、成功案例、正面结果
\newcommand{\iqbgreenbox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqbgreen}%
  \setbeamercolor{block body}{fg=black,bg=iqbgreen!10}%
  {\setbeamerfont{block title}{size=\footnotesize}%
   \begin{block}{\textbf{#1}}
     #2
   \end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%  % 恢复默认
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

% 红色警告框（谨慎使用）
% Usage: \iqbredbox{标题}{内容}
% 适用：错误、严重问题、需要立即关注的内容
% 注意：红色有强烈视觉冲击，避免过度使用
\newcommand{\iqbredbox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqbred}%
  \setbeamercolor{block body}{fg=black,bg=iqbred!10}%
  {\setbeamerfont{block title}{size=\footnotesize}%
   \begin{block}{\textbf{#1}}
     #2
   \end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%  % 恢复默认
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

% ============================================================
% Code Display Support (代码展示支持)
% ============================================================
% 需要用户在.tex中添加 \usepackage{listings} 包

% 行内代码样式
% Usage: 使用\iqbinlinecode{plt.show()}进行绘图
% 效果：等宽字体，浅灰背景
\DeclareRobustCommand{\iqbinlinecode}[1]{\texttt{\colorbox{gray!15}{#1}}}

% 代码块环境（需要listings包）
% Usage:
%   \begin{iqbcode}[Python]
%   import numpy as np
%   x = np.linspace(0, 10, 100)
%   \end{iqbcode}
% 注意：这个环境需要用户在.tex中先加载listings包
\RequirePackage{listings}

\lstnewenvironment{iqbcode}[1][]{%
  \lstset{
    basicstyle=\ttfamily\scriptsize,
    frame=single,
    backgroundcolor=\color{gray!10},
    keywordstyle=\color{iqbblue}\bfseries,
    commentstyle=\color{iqbgray}\itshape,
    stringstyle=\color{iqborange},
    numbers=left,
    numberstyle=\tiny\color{iqbgray},
    breaklines=true,
    language=#1
  }
}{}

% 简化版代码块命令（不需要environment）
% Usage: \iqbcodebox{Python}{import numpy as np\\x = [1, 2, 3]}
% 注意：换行需要使用 \\ 或实际换行
\newcommand{\iqbcodebox}[2]{%
  \begin{block}{代码示例：#1}
    \ttfamily\scriptsize
    \begin{flushleft}
    \colorbox{gray!10}{\parbox{0.95\textwidth}{%
      #2
    }}
    \end{flushleft}
  \end{block}
}

% ============================================================
% Appendix Mode (附录模式)
% ============================================================
% 用于在主演示后添加备份slides，不计入总页数

% 开启附录模式（之后的slides不计页码）
% Usage: \iqbappendix
% 效果：后续slides显示为"backup slides"，页码独立
\newcommand{\iqbappendix}{%
  \appendix
  \setsection{Backup Slides}
  % 可选：修改footer显示"附录"而非页码
  % \setbeamertemplate{footline}[frame number]
}

% ============================================================
% Footer Citation System (页脚引用系统)
% ============================================================
% 用于在页面footer显示参考文献、URL或DOI链接
% 适用场景：引用原文献、显示数据来源、标注图片出处

% Footer完整引用（需要biblatex或natbib包）
% Usage:
%   \iqbfootcite{bibtex-key}  % 在frame末尾调用
% 示例:
%   \begin{frame}{研究背景}
%     内容...
%     \iqbfootcite{smith2023}
%   \end{frame}
% 注意：需要在主文档中加载 \usepackage[style=authoryear]{biblatex} 并添加 \addbibresource{references.bib}
\newcommand{\iqbfootcite}[1]{%
  \footnote{\tiny\fullcite{#1}}%
}

% Footer URL显示（带可选标题）
% Usage:
%   \iqbfooterurl{https://example.com}  % 仅显示URL
%   \iqbfooterurl[来源]{https://example.com}  % 带标题显示
% 示例:
%   \iqbfooterurl[Official Documentation]{https://docs.python.org}
\newcommand{\iqbfooterurl}[2][]{%
  \ifx&#1&%
    \footnote{\tiny\url{#2}}%
  \else%
    \footnote{\tiny#1: \url{#2}}%
  \fi%
}

% Footer DOI链接（自动添加可点击超链接）
% Usage:
%   \iqbfooterdoi{10.1038/nature12345}
% 效果: DOI: 10.1038/nature12345 (可点击跳转至doi.org)
% 注意：需要 hyperref 包支持（IQB主题已包含）
\newcommand{\iqbfooterdoi}[1]{%
  \footnote{\tiny DOI: \href{https://doi.org/#1}{\nolinkurl{#1}}}%
}

% 组合引用命令（同时显示引用+URL）
% Usage:
%   \iqbfootcitewithurl{bibtex-key}{https://arxiv.org/abs/2301.12345}
% 效果: 完整引用 + 在线链接
\newcommand{\iqbfootcitewithurl}[2]{%
  \footnote{\tiny\fullcite{#1} \\ \url{#2}}%
}

% 图片局部居中命令（不影响后续文字）
% 使用 \begingroup...\endgroup 局限 \centering 作用域
\newcommand{\iqbimgcenter}[2][width=0.5\textwidth]{%
  \begingroup%
  \centering%
  \includegraphics[#1]{#2}\par%
  \endgroup%
}

% ============================================================
% Overrides: Punchline sizing management
% ============================================================
% Make punchline box title/body sizes configurable and align body with itemize
\providecommand{\iqbpunchlinetitlesize}{\footnotesize}
\providecommand{\iqbpunchlinebodysize}{\footnotesize}

\renewcommand{\iqbbluebox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
  {\setbeamerfont{block title}{size=\iqbpunchlinetitlesize}%
   \setbeamerfont{block body}{size=\iqbpunchlinebodysize}%
   \begin{block}{\textbf{#1}}#2\end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

\renewcommand{\iqborangebox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqborange}%
  \setbeamercolor{block body}{fg=black,bg=iqborange!10}%
  {\setbeamerfont{block title}{size=\iqbpunchlinetitlesize}%
   \setbeamerfont{block body}{size=\iqbpunchlinebodysize}%
   \begin{block}{\textbf{#1}}#2\end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

\renewcommand{\iqbgreenbox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqbgreen}%
  \setbeamercolor{block body}{fg=black,bg=iqbgreen!10}%
  {\setbeamerfont{block title}{size=\iqbpunchlinetitlesize}%
   \setbeamerfont{block body}{size=\iqbpunchlinebodysize}%
   \begin{block}{\textbf{#1}}#2\end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

\renewcommand{\iqbredbox}[2]{%
  \setbeamercolor{block title}{fg=white,bg=iqbred}%
  \setbeamercolor{block body}{fg=black,bg=iqbred!10}%
  {\setbeamerfont{block title}{size=\iqbpunchlinetitlesize}%
   \setbeamerfont{block body}{size=\iqbpunchlinebodysize}%
   \begin{block}{\textbf{#1}}#2\end{block}%
  }%
  \setbeamercolor{block title}{fg=white,bg=iqbblue}%
  \setbeamercolor{block body}{fg=black,bg=iqblightgray!30}%
}

% ============================================================
% Unified sizing: section titles, itemize, and punchline boxes
% ============================================================
% Expose two size knobs so document authors can keep fonts consistent.
\providecommand{\iqbsectionsize}{\normalsize}  % used by \iqbsectiontitle
\providecommand{\iqbitemsize}{\footnotesize}   % used by lists and punchline body

% Make \iqbsectiontitle use the configurable size
\renewcommand{\iqbsectiontitle}[2][iqbblue]{%
  {\iqbsectionsize\textcolor{#1}{\textbf{#2}}}\vspace{-0.5em}%
}

% Couple punchline sizes to the unified knobs
\renewcommand{\iqbpunchlinetitlesize}{\iqbsectionsize}
\renewcommand{\iqbpunchlinebodysize}{\iqbitemsize}

% Section divider page without footer (no page number line)
\renewcommand{\iqbsectionframe}[2]{%
  \setsection{#1}%
  \begin{frame}[plain,noframenumbering]
    \begingroup
      % Hide footer (page line + page number) on section divider only
      \setbeamertemplate{footline}{}

      % Background gradient (subtle right light gray)
      \begin{tikzpicture}[remember picture,overlay]
        \fill[white] (current page.south west) rectangle (current page.north east);
        \shade[left color=white, right color=iqblightgray!30]
              (current page.south west) rectangle (current page.north east);
      \end{tikzpicture}

      % Left vertical accent bar
      \begin{tikzpicture}[remember picture,overlay]
        \draw[line width=8pt, color=iqbblue]
             (current page.north west) -- (current page.south west);
      \end{tikzpicture}

      % Decorative protein silhouette (keep as required)
      \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=south east, inner sep=0pt, opacity=0.12]
             at ($(current page.south east) + (-1cm, 1cm)$) {
          \includegraphics[height=5cm,keepaspectratio]{../theme/images/protein.png}
        };
      \end{tikzpicture}

      % Centered title and subtitle
      \vspace*{0.5cm}
      \begin{center}
        {\Huge\color{iqbblue}\textbf{#2}}\\[0.3cm]
        {\Large\color{iqbgray}#1}
      \end{center}
      \vspace*{0.3cm}
    \endgroup
  \end{frame}
}

\endinput
