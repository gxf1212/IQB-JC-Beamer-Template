% ============================================================
% IQB Journal Club Layout Utilities
%
% LaTeX Beamer 布局工具包 - 为 IQB 课题组文献分享演示提供
% 统一的、可复用的布局命令和页面模块
%
% 版本: 1.0 | 最后更新: 2025-10-20
%
% 快速开始:
%   \usepackage{iqb-layouts}
%
% 主要功能模块:
%   1. 布局命令 - \iqblayouttwo, \iqblayoutthree, \iqbgridtwobytwo 等
%   2. 图片模块 - \iqbfig, \iqbtwofig, \iqbfourfig（自动编号）
%   3. 文字+图片混合 - \iqbimagetext, \iqbtextimage
%   4. 作者信息 - \iqbauthorstwophoto, \iqbauthorstwo
%   5. 对比模块 - \iqbcomparetwo, \iqbcomparethree
%   6. Frame 快捷命令 - \iqbframe, \iqbframetextfig 等
%   7. 间距命令 - \iqbsep, \iqbbigsep, \iqbtinysep
%
% 详细说明: 见本文件下方的每个模块注释
% ============================================================

\ProvidesPackage{iqb-layouts}[2025/01/20 v1.0 IQB Journal Club Layout Utilities]

\RequirePackage{graphicx}
\RequirePackage{tikz}
\usetikzlibrary{positioning,calc}

% ============================================================
% Spacing Commands (统一的间距系统)
% ============================================================
%
% 该包提供了三个标准的间距命令，用于替代手动的 \medskip, \bigskip,
% \smallskip, \vspace{}。使用统一的间距命令可以确保整个演示的视觉一致性。
%
% 使用建议:
%   - 优先使用 \iqbsep（标准间距）分隔逻辑块
%   - \iqbtinysep 用于列表项之间或紧凑布局
%   - \iqbbigsep 用于主要内容块之间的大分隔
%
% 示例:
%   \begin{itemize}
%     \item 第一点
%     \item 第二点
%   \end{itemize}
%   \iqbsep  %← 使用统一间距而不是 \vspace{0.3cm}
%   \begin{block}{重点}
%     ...
%   \end{block}
%
\newcommand{\iqbsep}{\vspace{0.3cm}}       % 标准段落间距 (~0.3cm)，最常用
\newcommand{\iqbbigsep}{\vspace{0.5cm}}    % 大段落间距 (~0.5cm)，用于主要分节
\newcommand{\iqbtinysep}{\vspace{0.15cm}}  % 小间距 (~0.15cm)，用于列表项间

% ============================================================
% Two-Column Layouts (双列布局 - 35% 使用率)
% ============================================================
%
% 双列布局是 JC 演示的核心布局类型（约 35% 的页面使用）。
% 本包提供了多种双列布局，覆盖常见的比例分割。
%
% 【1. 标准 50-50 双列】
% \iqblayouttwo{左列}{右列}
% 用途: 对比、左右平行内容、方法对比
% 布局: 左 48% + 间隔 4% + 右 48%
% 示例:
%   \begin{frame}{方法对比}
%     \iqblayouttwo{
%       方法A \\
%       优点: 快速
%     }{
%       方法B \\
%       优点: 精确
%     }
%   \end{frame}
%
\newcommand{\iqblayouttwo}[2]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      #1
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      #2
    \end{column}
  \end{columns}
}

% 【2. 非对称 1/3:2/3 双列（图在左，文在右）】
% \iqblayoutonethird{左侧（窄）}{右侧（宽）}
% 用途: 左侧是图或装置，右侧是详细说明
% 布局: 左 31% + 间隔 4% + 右 65%
% 建议: 左侧图片宽度设为 width=0.25-0.30\textwidth
% 示例:
%   \iqblayoutonethird{
%     \includegraphics[width=0.3\textwidth]{device.png}
%   }{
%     \textbf{详细说明} \\
%     这是该装置的工作原理...
%   }
%
\newcommand{\iqblayoutonethird}[2]{%
  \begin{columns}[T]
    \begin{column}{0.31\textwidth}
      #1
    \end{column}
    \hfill
    \begin{column}{0.65\textwidth}
      #2
    \end{column}
  \end{columns}
}

% 【3. 非对称 2/3:1/3 双列（文在左，图在右）】
% \iqblayouttwothirds{左侧（宽）}{右侧（窄）}
% 用途: 左侧是详细说明或列表，右侧是图或数据
% 布局: 左 65% + 间隔 4% + 右 31%
% 建议: 右侧图片宽度设为 width=0.25-0.30\textwidth
%
\newcommand{\iqblayouttwothirds}[2]{%
  \begin{columns}[T]
    \begin{column}{0.65\textwidth}
      #1
    \end{column}
    \hfill
    \begin{column}{0.31\textwidth}
      #2
    \end{column}
  \end{columns}
}

% 【4. 自定义比例双列】
% \iqblayoutcustom[左宽度]{左列}{右列}
% 用途: 任意比例的双列分割
% 参数: [可选] 左列宽度（默认 0.4\textwidth）
% 示例:
%   \iqblayoutcustom[0.35]{
%     窄左列
%   }{
%     宽右列
%   }
%   或
%   \iqblayoutcustom[0.6]{
%     宽左列
%   }{
%     窄右列
%   }
%
\newcommand{\iqblayoutcustom}[3][0.4]{%
  \begin{columns}[T]
    \begin{column}{#1\textwidth}
      #2
    \end{column}
    \hfill
    \begin{column}{\dimexpr 1\textwidth - #1\textwidth - 0.04\textwidth\relax}
      #3
    \end{column}
  \end{columns}
}

% ============================================================
% Three-Column Layouts (三列布局 - 25% 使用率)
% ============================================================
%
% 【1. 标准三列均分】
% \iqblayoutthree{列1}{列2}{列3}
% 用途: 三方对比、三个方法、三个结果展示
% 布局: 每列 31% (中间有间隔)
% 注意: 内容受限，字号会自动缩小
% 建议每列图片高度: height=0.35-0.40\textheight
% 示例:
%   \iqblayoutthree{
%     \centering
%     \textbf{方法A} \\
%     \includegraphics[height=0.35\textheight]{img1.png}
%   }{
%     \centering
%     \textbf{方法B} \\
%     \includegraphics[height=0.35\textheight]{img2.png}
%   }{
%     \centering
%     \textbf{我们的方法} \\
%     \includegraphics[height=0.35\textheight]{img3.png}
%   }
%
\newcommand{\iqblayoutthree}[3]{%
  \begin{columns}[T]
    \begin{column}{0.31\textwidth}
      #1
    \end{column}
    \begin{column}{0.31\textwidth}
      #2
    \end{column}
    \begin{column}{0.31\textwidth}
      #3
    \end{column}
  \end{columns}
}

% ============================================================
% Grid Layouts for Multiple Images (网格布局 - 少见)
% ============================================================
%
% 网格布局用于展示多个相关的图表，特别是用于矩阵式的数据展示。
% 最常见的是 2×2 和 3×2 网格。

% 【1. 2×2 网格（4 个图或面板）】
\newcommand{\iqbgridtwobytwo}[4]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      #1
      \vskip1em
      #3
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      #2
      \vskip1em
      #4
    \end{column}
  \end{columns}
}

% 3x2 Grid (6 images)
\newcommand{\iqbgridthreebytwo}[6]{%
  \begin{columns}[T]
    \begin{column}{0.31\textwidth}
      #1
      \vskip0.5em
      #4
    \end{column}
    \begin{column}{0.31\textwidth}
      #2
      \vskip0.5em
      #5
    \end{column}
    \begin{column}{0.31\textwidth}
      #3
      \vskip0.5em
      #6
    \end{column}
  \end{columns}
}

% ============================================================
% Figure Modules with Numbered Captions (带编号的图片模块 - 最常用)
% ============================================================
%
% 该包提供的图片模块自动处理图片编号、对齐和图注格式。
% 所有图注都是左对齐，编号自动递增。
% 这是展示实验结果、数据分析、装置图等的标准方式。
%
% 【重要】: 使用这些命令比手动排版图片更简洁、更一致。

% 内部计数器（自动维护）
\newcounter{iqbfigure}
\setcounter{iqbfigure}{0}

% 【1. 单个图片】
% \iqbfig[图片选项]{图片路径}{图注文本}
% 参数:
%   [可选] 图片选项: height=0.5\textheight (默认), width=\textwidth 等
%   图片路径: 相对或绝对路径，如 images/fig1.png
%   图注文本: 在"图N："后的描述文字
% 示例:
%   \iqbfig{images/structure.png}{蛋白质主链构象}
%   \iqbfig[height=0.6\textheight]{images/result.png}{能量景观的三维表示}
% 输出:
%   [图像]
%   图1: 蛋白质主链构象
%
\newcommand{\iqbfig}[3][height=0.5\textheight]{%
  \refstepcounter{iqbfigure}%
  \centering
  \includegraphics[#1,keepaspectratio]{#2}

  \vspace{0.15cm}

  \raggedright
  \scriptsize
  \textbf{图\theiqbfigure}：#3
}

% Two figures side by side with individual numbered captions
% Usage: \iqbtwofig[options]{img1}{caption1}{img2}{caption2}
\newcommand{\iqbtwofig}[5][height=0.45\textheight]{%
  \iqblayouttwo{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#2}

    \vspace{0.1cm}

    \raggedright
    \scriptsize
    \textbf{图\theiqbfigure}：#3
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#4}

    \vspace{0.1cm}

    \raggedright
    \scriptsize
    \textbf{图\theiqbfigure}：#5
  }
}

% Three figures in a row with captions
% Usage: \iqbthreefig[options]{img1}{caption1}{img2}{caption2}{img3}{caption3}
\newcommand{\iqbthreefig}[7][height=0.35\textheight]{%
  \iqblayoutthree{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#2}

    \vspace{0.1cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#3
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#4}

    \vspace{0.1cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#5
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#6}

    \vspace{0.1cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#7
  }
}

% 2x2 grid with numbered captions
% Usage: \iqbfourfig[options]{img1}{caption1}{img2}{caption2}{img3}{caption3}{img4}{caption4}
\newcommand{\iqbfourfig}[9][height=0.35\textheight]{%
  \iqbgridtwobytwo{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#2}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#3
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#4}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#5
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#6}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#7
  }{
    \refstepcounter{iqbfigure}%
    \centering
    \includegraphics[#1,keepaspectratio]{#8}

    \vspace{0.05cm}

    \raggedright
    \tiny
    \textbf{图\theiqbfigure}：#9
  }
}

% ============================================================
% Legacy Image + Caption Utilities (for backward compatibility)
% ============================================================

% Image with caption below
\newcommand{\iqbfigure}[3][width=\textwidth]{%
  \begin{figure}
    \centering
    \includegraphics[#1]{#2}
    \ifx&#3&%
    \else
      \caption{#3}
    \fi
  \end{figure}
}

% Side-by-side images with individual captions
\newcommand{\iqbtwofigures}[6][width=0.45\textwidth]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      \begin{figure}
        \centering
        \includegraphics[#1]{#2}
        \ifx&#3&%
        \else
          \caption{#3}
        \fi
      \end{figure}
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      \begin{figure}
        \centering
        \includegraphics[#4]{#5}
        \ifx&#6&%
        \else
          \caption{#6}
        \fi
      \end{figure}
    \end{column}
  \end{columns}
}

% ============================================================
% Text + Image Layouts
% ============================================================

% Image on left, text on right
\newcommand{\iqbimagetext}[3][width=0.45\textwidth]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      \includegraphics[#1]{#2}
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      #3
    \end{column}
  \end{columns}
}

% Text on left, image on right
\newcommand{\iqbtextimage}[3][width=0.45\textwidth]{%
  \begin{columns}[T]
    \begin{column}{0.48\textwidth}
      #2
    \end{column}
    \hfill
    \begin{column}{0.48\textwidth}
      \includegraphics[#1]{#3}
    \end{column}
  \end{columns}
}

% ============================================================
% Precise Positioning (for irregular layouts - 10% usage)
% ============================================================

% Place content at precise coordinates
% Usage: \iqbplace{x}{y}{width}{content}
% Coordinates: (0,0) is top-left, units in cm
\newcommand{\iqbplace}[4]{%
  \begin{tikzpicture}[remember picture,overlay]
    \node[anchor=north west,inner sep=0pt] at ($(current page.north west) + (#1,-#2)$) {
      \begin{minipage}{#3}
        #4
      \end{minipage}
    };
  \end{tikzpicture}
}

% Place image at precise coordinates with size
% Usage: \iqbplaceimage{x}{y}{width}{height}{image-file}
\newcommand{\iqbplaceimage}[5]{%
  \begin{tikzpicture}[remember picture,overlay]
    \node[anchor=north west,inner sep=0pt] at ($(current page.north west) + (#1,-#2)$) {
      \includegraphics[width=#3,height=#4,keepaspectratio]{#5}
    };
  \end{tikzpicture}
}

% ============================================================
% Author Information Modules (Commonly used in JC papers)
% ============================================================

% Two authors with photos: Corresponding + First Author
% Usage: \iqbauthorstwophoto{corr-photo}{corr-name}{corr-affiliation}{corr-url}{corr-research}
%                            {first-photo}{first-name}{first-affiliation}{first-url}{first-field}
\newcommand{\iqbauthorstwophoto}[9]{%
  \iqblayouttwo{
    % Corresponding Author
    \begin{block}{通讯作者 (Corresponding Author)}
      \vspace{0.1cm}
      \begin{minipage}{0.25\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth,height=2.5cm,keepaspectratio]{#1}
      \end{minipage}%
      \hfill
      \begin{minipage}{0.70\textwidth}
        \textbf{\scriptsize #2}\\[0.1cm]
        \scriptsize #3\\[0.1cm]
        \textcolor{blue}{\scriptsize #4}\\[0.1cm]
        \textbf{\scriptsize 研究方向}：\\
        \scriptsize #5
      \end{minipage}
      \vspace{0.1cm}
    \end{block}
  }{
    % First Author
    \begin{block}{第一作者 (First Author)}
      \vspace{0.1cm}
      \begin{minipage}{0.25\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth,height=2.5cm,keepaspectratio]{#6}
      \end{minipage}%
      \hfill
      \begin{minipage}{0.70\textwidth}
        \textbf{\scriptsize #7}\\[0.1cm]
        \scriptsize #8\\[0.1cm]
        \textcolor{blue}{\scriptsize #9}\\[0.1cm]
        \textbf{\scriptsize 专业领域}：\\
        \scriptsize \iqbauthorfirstfield
      \end{minipage}
      \vspace{0.1cm}
    \end{block}
  }
}

% Helper command for first author field (to work around 9-param limit)
\newcommand{\iqbauthorfirstfield}{}
\newcommand{\setauthorfirstfield}[1]{\renewcommand{\iqbauthorfirstfield}{#1}}

% Two authors WITHOUT photos (original version)
% Usage: \iqbauthorstwo{corr-name}{corr-affiliation}{corr-url}{corr-research}
%                       {first-name}{first-affiliation}{first-url}{first-field}
\newcommand{\iqbauthorstwo}[8]{%
  \iqblayouttwo{
    % Corresponding Author
    \begin{block}{通讯作者 (Corresponding Author)}
      \vspace{0.15cm}
      \textbf{\scriptsize #1}\\[0.15cm]
      \scriptsize #2\\[0.15cm]
      \textcolor{blue}{\scriptsize #3}\\[0.15cm]
      \textbf{\scriptsize 研究方向}：\\
      \scriptsize #4
      \vspace{0.1cm}
    \end{block}
  }{
    % First Author
    \begin{block}{第一作者 (First Author)}
      \vspace{0.15cm}
      \textbf{\scriptsize #5}\\[0.15cm]
      \scriptsize #6\\[0.15cm]
      \textcolor{blue}{\scriptsize #7}\\[0.15cm]
      \textbf{\scriptsize 专业领域}：\\
      \scriptsize #8
      \vspace{0.1cm}
    \end{block}
  }
}

% Single author (e.g., solo paper or review)
% Usage: \iqbauthorone{name}{affiliation}{url}{research}
\newcommand{\iqbauthorone}[4]{%
  \begin{block}{作者 (Author)}
    \vspace{0.2cm}
    \centering
    \textbf{\scriptsize #1}\\[0.3cm]
    \scriptsize #2\\[0.2cm]
    \textcolor{blue}{\scriptsize #3}\\[0.3cm]
    \textbf{\scriptsize 研究方向}：\\
    \scriptsize #4
    \vspace{0.2cm}
  \end{block}
}

% Three authors layout (simplified - 3 authors info blocks)
% Usage: \iqbauthorsthree{author1-block}{author2-block}{author3-block}
% Each block should contain formatted author info
\newcommand{\iqbauthorsthree}[3]{%
  \iqblayoutthree{
    \begin{block}{\small 作者 1}
      \small
      #1
    \end{block}
  }{
    \begin{block}{\small 作者 2}
      \small
      #2
    \end{block}
  }{
    \begin{block}{\small 作者 3}
      \small
      #3
    \end{block}
  }
}

% ============================================================
% Formula + Explanation Module (公式+解释布局)
% ============================================================

% Formula on left, explanation on right
% Usage: \iqbformulaexplain{formula-content}{explanation-text}
\newcommand{\iqbformulaexplain}[2]{%
  \iqblayoutonethird{
    \centering
    #1
  }{
    #2
  }
}

% ============================================================
% Key Points Module (关键要点提炼)
% ============================================================

% Highlighted key points block
% Usage: \iqbkeypoints{itemize-content}
\newcommand{\iqbkeypoints}[1]{%
  \begin{block}{{\color{iqbblue}\textbf{关键要点 (Key Points)}}}
    #1
  \end{block}
}

% ============================================================
% Comparison Table Module (对比表格)
% ============================================================

% Simple two-column comparison
% Usage: \iqbcomparetwo{method-a-title}{method-a-content}
%                       {method-b-title}{method-b-content}
\newcommand{\iqbcomparetwo}[4]{%
  \iqblayouttwo{
    \centering
    \textbf{#1}

    \vspace{0.2cm}

    #2
  }{
    \centering
    \textbf{#3}

    \vspace{0.2cm}

    #4
  }
}

% Three-column comparison
% Usage: \iqbcomparethree{titleA}{contentA}{titleB}{contentB}{titleC}{contentC}
\newcommand{\iqbcomparethree}[6]{%
  \iqblayoutthree{
    \centering
    \textbf{#1}

    \vspace{0.15cm}

    #2
  }{
    \centering
    \textbf{#3}

    \vspace{0.15cm}

    #4
  }{
    \centering
    \textbf{#5}

    \vspace{0.15cm}

    #6
  }
}

% ============================================================
% Timeline / Workflow Module (时间线/流程)
% ============================================================

% Three-step timeline with arrows
% Usage: \iqbtimeline{step1-title}{step1-content}
%                    {step2-title}{step2-content}
%                    {step3-title}{step3-content}
\newcommand{\iqbtimeline}[6]{%
  \begin{center}
  \begin{tikzpicture}[
    node distance=0.5cm,
    box/.style={rectangle, draw=iqbblue, fill=iqblightgray, thick, minimum height=2cm, minimum width=3.5cm, align=center},
    arrow/.style={->, >=stealth, thick, color=iqbblue}
  ]
    \node[box] (step1) {\textbf{\scriptsize #1}\\[0.2cm]\scriptsize #2};
    \node[box, right=of step1] (step2) {\textbf{\scriptsize #3}\\[0.2cm]\scriptsize #4};
    \node[box, right=of step2] (step3) {\textbf{\scriptsize #5}\\[0.2cm]\scriptsize #6};

    \draw[arrow] (step1.east) -- (step2.west);
    \draw[arrow] (step2.east) -- (step3.west);
  \end{tikzpicture}
  \end{center}
}

% ============================================================
% Conclusion / Summary Module (结论总结)
% ============================================================

% Centered conclusion block
% Usage: \iqbconclusion{conclusion-text}
\newcommand{\iqbconclusion}[1]{%
  \begin{block}{\centering \textbf{结论 (Conclusion)}}
    \centering
    #1
  \end{block}
}

% ============================================================
% Research Question Module (研究问题)
% ============================================================

% Highlighted research question
% Usage: \iqbquestion{question-text}
\newcommand{\iqbquestion}[1]{%
  \begin{block}{\centering \textbf{核心问题 (Research Question)}}
    \centering
    #1
  \end{block}
}

% ============================================================
% Advanced Shortcuts (高级快捷命令 - Phase 1 增强)
% 用于快速创建常见frame模式，减少代码重复
% ============================================================

% ============================================================
% Frame Shortcuts (Frame快捷命令)
% ============================================================

% 标准单栏frame
% Usage: \iqbframe{标题}{内容}
\newcommand{\iqbframe}[2]{%
  \begin{frame}{#1}
    #2
  \end{frame}
}

% 文字+图片左右分栏frame (文字占1/3，图片占2/3)
% Usage: \iqbframetextfig{标题}{文字内容}{图片路径}
%   或: \iqbframetextfig[0.6\textheight]{标题}{文字内容}{图片路径}
%   或: \iqbframetextfig[0.6\textheight]{标题}{文字内容}{图片路径}{图注}
% 新增: 第5个参数用于图片下的图注（可选）
\newcommand{\iqbframetextfig}[5][0.55\textheight]{%
  \begin{frame}{#2}
    \iqblayoutonethird{%
      #3%
    }{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#4}%
      \ifx&#5&%
        % 没有提供图注
      \else
        % 提供了图注，显示在图片下
        \medskip
        \iqbcaptiontext{#5}%
      \fi
    }%
  \end{frame}
}

% 图片+文字左右分栏frame (图片占1/3，文字占2/3)
% Usage: \iqbframefigttext{标题}{图片路径}{文字内容}
%   或: \iqbframefigttext[0.6\textheight]{标题}{图片路径}{文字内容}
\newcommand{\iqbframefigttext}[4][0.55\textheight]{%
  \begin{frame}{#2}
    \iqblayouttwothirds{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#3}%
    }{%
      #4%
    }%
  \end{frame}
}

% 文字+两个图片frame (文字占1/3，两个图片并排占2/3)
% Usage: \iqbframetexttwofig{标题}{文字}{img1}{caption1}{img2}{caption2}
%   或: \iqbframetexttwofig[0.45\textheight]{标题}{文字}{img1}{cap1}{img2}{cap2}
\newcommand{\iqbframetexttwofig}[7][0.45\textheight]{%
  \begin{frame}{#2}
    \iqblayoutonethird{%
      #3%
    }{%
      \iqbtwofig[height=#1]{#4}{#5}{#6}{#7}%
    }%
  \end{frame}
}

% ============================================================
% Section Management (Section管理命令)
% ============================================================

% 自动生成section分隔页，无需手动 \setsection
% Usage: \iqbsectionframe{Methods}{方法}
%   参数1: section英文名 (用于footer)
%   参数2: 分隔页显示的中文标题
\newcommand{\iqbsectionframe}[2]{%
  \setsection{#1}%
  \begin{frame}[plain,noframenumbering]
    % 背景：浅蓝色渐变 (白 → 淡蓝)
    \begin{tikzpicture}[remember picture,overlay]
      \fill[white] (current page.south west) rectangle (current page.north east);
      \shade[left color=white, right color=iqblightgray!30] (current page.south west) rectangle (current page.north east);
    \end{tikzpicture}

    % 左侧装饰条（竖线）
    \begin{tikzpicture}[remember picture,overlay]
      \draw[line width=8pt, color=iqbblue] (current page.north west) -- (current page.south west);
    \end{tikzpicture}

    % 右下角装饰（protein图案）
    \begin{tikzpicture}[remember picture,overlay]
      \node[anchor=south east, inner sep=0pt, opacity=0.12] at ($(current page.south east) + (-1cm, 1cm)$) {
        \includegraphics[height=5cm,keepaspectratio]{../theme/images/protein.png}
      };
    \end{tikzpicture}

    % 标题文字 + 英文副标题
    \begin{tikzpicture}[remember picture,overlay]
      \node[anchor=center] at ($(current page.center) + (0, 0.5cm)$) {
        \begin{minipage}{0.8\paperwidth}
          \centering
          {\Huge\color{iqbblue}\textbf{#2}}\\[0.3cm]
          {\Large\color{iqbgray}#1}
        \end{minipage}
      };
    \end{tikzpicture}

    % 底部装饰线
    \begin{tikzpicture}[remember picture,overlay]
      \draw[line width=1.5pt, color=iqbblue] ($(current page.south west) + (0.5cm, 0.8cm)$) -- ($(current page.south east) + (-0.5cm, 0.8cm)$);
    \end{tikzpicture}
  \end{frame}
}

% ============================================================
% Formula + Explanation Layout (公式+解释专用布局)
% ============================================================

% 单个公式块 (包含标题+公式+解释，自动间距管理)
% Usage: \iqbformblock{标题}{公式内容}{解释文字}
% 示例:
%   \iqbformblock{成核部分 $\text{CV}_{\text{cyl}}$}{
%     $$\text{CV}_{\text{cyl}} = 1 - d/\text{CV}_{\text{eq}}$$
%   }{$d$: 圆柱内脂质尾部原子数}
\newcommand{\iqbformblock}[3]{%
  \textbf{#1}：\\*[-0.1cm]
  \vspace{0.05cm}

  #2  % 公式

  \vspace{0.05cm}

  {\footnotesize #3}  % 解释

  \smallskip
}

% 公式+解释Frame (左侧1/3公式/代码，右侧2/3图片或文字)
% Usage: \iqbformulaframe{标题}{左侧公式内容}{右侧内容}
% 示例:
%   \iqbformulaframe{Full-Path CV原理}{
%     \iqbformblock{成核}{$$\text{CV}_{\text{cyl}} = ...$$}{解释}
%     \iqbformblock{扩展}{$$\text{CV}_{\text{radius}} = ...$$}{解释}
%   }{
%     \iqbfig[height=0.55\textheight]{图片.png}{图注}
%   }
\newcommand{\iqbformulaframe}[3]{%
  \begin{frame}{#1}
    \iqblayoutonethird{#2}{#3}%
  \end{frame}
}

% ============================================================
% Three-Column Comparison Template (三列对比专用)
% ============================================================

% 三列对比 (标题+图片+列表的标准模式)
% Usage: \iqbthreecolcompare{title1}{img1}{items1}{title2}{img2}{items2}{title3}{img3}{content3}
%   参数: title=标题，img=图片路径，items=\item 列表项，content=文字内容
% 示例:
%   \iqbthreecolcompare
%     {Full-Path CV}{fig1u.png}{\item 成核+扩展 \item 无滞后}
%     {Rapid CV}{fig1d.png}{\item 无限孔 \item 高效}
%     {开源实现}{plumed.png}{PLUMED库\\GROMACS/LAMMPS}
\newcommand{\iqbthreecolcompare}[9]{%
  \iqblayoutthree{%
    \centering
    \textbf{#1}

    \medskip

    \includegraphics[width=\textwidth]{#2}

    \medskip

    \begin{itemize}
      #3
    \end{itemize}
  }{%
    \centering
    \textbf{#4}

    \medskip

    \includegraphics[width=\textwidth]{#5}

    \medskip

    \begin{itemize}
      #6
    \end{itemize}
  }{%
    \centering
    \textbf{#7}

    \medskip

    \includegraphics[width=\textwidth,height=0.4\textheight,keepaspectratio]{#8}

    \medskip

    \begin{itemize}
      #9
    \end{itemize}
  }%
}

% ============================================================
% Block Shortcuts (块级快捷命令)
% ============================================================

% 快速创建block
% Usage: \iqbblock{标题}{内容}
\newcommand{\iqbblock}[2]{%
  \begin{block}{#1}
    #2
  \end{block}
}

% 快速创建列表
% Usage: \iqbitemize{\item 项1 \item 项2}
\newcommand{\iqbitemize}[1]{%
  \begin{itemize}
    #1
  \end{itemize}
}

% 快速创建编号列表
% Usage: \iqbenumerate{\item 项1 \item 项2}
\newcommand{\iqbenumerate}[1]{%
  \begin{enumerate}
    #1
  \end{enumerate}
}

% ============================================================
% Two-Method Comparison Layout (双方法对比)
% ============================================================

% 两列对比 (标题+图片+列表)
% Usage: \iqbtwocolcompare{title1}{img1}{items1}{title2}{img2}{items2}
%   或仅文字版: \iqbtwocolcompare{title1}{}{text1}{title2}{}{text2}
\newcommand{\iqbtwocolcompare}[6]{%
  \iqblayouttwo{%
    \centering
    \textbf{#1}

    \medskip

    \ifx&#2&%
      % 无图片，仅显示文字
      #3
    \else
      % 有图片
      \includegraphics[width=\textwidth]{#2}

      \medskip

      \begin{itemize}#3\end{itemize}
    \fi
  }{%
    \centering
    \textbf{#4}

    \medskip

    \ifx&#5&%
      % 无图片，仅显示文字
      #6
    \else
      % 有图片
      \includegraphics[width=\textwidth]{#5}

      \medskip

      \begin{itemize}#6\end{itemize}
    \fi
  }%
}

% ============================================================
% Validation/Results Layout (验证结果专用布局)
% ============================================================

% 结果展示frame (左侧1/3文字，右侧2/3图片)
% Usage: \iqbresultframe{标题}{左侧文字}{右侧图片}
% 自动应用合适的字体大小和间距
\newcommand{\iqbresultframe}[3]{%
  \begin{frame}{#1}
    \iqblayoutonethird{%
      \footnotesize
      #2
    }{%
      \centering
      \includegraphics[height=0.65\textheight,keepaspectratio]{#3}
    }%
  \end{frame}
}

% 对比结果frame (两个并排结果展示)
% Usage: \iqbcomparisonframe{标题}{左图}{左标题}{右图}{右标题}
\newcommand{\iqbcomparisonframe}[5]{%
  \begin{frame}{#1}
    \iqbtwofig[height=0.55\textheight]{#2}{#3}{#4}{#5}%
  \end{frame}
}

% ============================================================
% Paper Metadata Commands (论文元数据预定义)
% ============================================================

% 初始化论文元数据存储变量
\newcommand{\papertitle}[1]{\def\@papertitle{#1}}
\newcommand{\paperengtitle}[1]{\def\@paperengtitle{#1}}
\newcommand{\papercitation}[1]{\def\@papercitation{#1}}
\newcommand{\paperdoi}[1]{\def\@paperdoi{#1}}
\newcommand{\paperjournal}[1]{\def\@paperjournal{#1}}
\newcommand{\correspondingauthor}[2]{\def\@corrauthor{#1}\def\@corraffil{#2}}
\newcommand{\firstauthor}[2]{\def\@firstauthor{#1}\def\@firstaffil{#2}}
\newcommand{\paperyear}[1]{\def\@paperyear{#1}}

% 设置默认值
\def\@papertitle{论文标题}
\def\@paperengtitle{Paper Title}
\def\@papercitation{Full Citation}
\def\@paperdoi{DOI}
\def\@paperjournal{Journal}
\def\@corrauthor{通讯作者}
\def\@corraffil{所属单位}
\def\@firstauthor{第一作者}
\def\@firstaffil{所属单位}
\def\@paperyear{\the\year}

% ============================================================
% Paper Metadata Display (论文元数据显示宏)
% ============================================================

% 显示发表信息（期刊+年份、体积、页码 | DOI）
% Usage: \iqbpublicationinfo
% 需预先定义: \paperdoi{...}
\newcommand{\iqbpublicationinfo}{%
  \textbf{发表}: \textit{J. Chem. Inf. Model.} \textbf{65}, 908–920 (2025) | \textbf{DOI}: \@paperdoi
}

% ============================================================
% Thank You Frame (致谢页 - 固定样式)
% ============================================================

% 致谢页frame（自动使用已定义的论文引用）
% Usage: \iqbthankyouframe
% 或指定自定义引用: \iqbthankyouframe[自定义引用文本]
\newcommand{\iqbthankyouframe}[1][\@papercitation]{%
  \begin{frame}[plain]
    \vfill
    \centering

    {\Huge \textcolor{iqbblue}{\textbf{Thanks for Listening!}}}

    \bigskip

    {\Large Questions?}

    \bigskip\bigskip

    {\normalsize
    \textbf{参考文献}：\\[0.2cm]
    #1
    }

    \vfill
  \end{frame}
}

% ============================================================
% Chinese Title Metadata (中文标题配置)
% ============================================================

% 中文主标题
% Usage: \papertitlechn{破解膜孔之谜：双CV联手揭示}
\newcommand{\papertitlechn}[1]{\def\@papertitlechn{#1}}

% 中文副标题
% Usage: \papertitlechnsub{从成核到扩展的完整能量图景}
\newcommand{\papertitlechnsub}[1]{\def\@papertitlechnsub{#1}}

% 设置默认值
\def\@papertitlechn{论文中文标题}
\def\@papertitlechnsub{论文中文副标题}

% ============================================================
% Caption Text Styling (图注样式复用)
% ============================================================

% 标准图注样式 (footnotesize + 左对齐 + 灵活右边距)
% Usage: \iqbcaptiontext{图注内容}
% 自动应用: \footnotesize + \raggedright + \setlength{\rightskip}{0pt plus 1cm}
\newcommand{\iqbcaptiontext}[1]{%
  {\footnotesize\raggedright\setlength{\rightskip}{0pt plus 1cm}
  #1
  }%
}

% 紧凑型图注 (用于多个小图的情况)
% Usage: \iqbcaptiontextsmall{内容}
\newcommand{\iqbcaptiontextsmall}[1]{%
  {\tiny\raggedright\setlength{\rightskip}{0pt plus 1cm}
  #1
  }%
}

% ============================================================
% Figure with Caption (居中图片+左对齐图注)
% ============================================================
% 标准图+图注模式：自动居中图片，图注左对齐且自动换行
% Usage: \iqbfigcap[图片选项]{图片路径}{图注内容}
% 默认图片高度: height=0.5\textheight（可通过可选参数覆盖）
% 例子：\iqbfigcap[width=0.9\textwidth]{path/to/image.png}{图注文本}
\newcommand{\iqbfigcap}[3][height=0.5\textheight]{%
  \begin{figure}[htbp]
    \centering
    \includegraphics[#1,keepaspectratio]{#2}
    \par\vskip0.2cm
    \begin{minipage}{0.9\linewidth}
      \iqbcaptiontext{#3}%
    \end{minipage}
  \end{figure}
}

% ============================================================
% Table Utilities (表格快捷命令)
% ============================================================

% 三线表 (使用booktabs风格)
% Usage: \iqbthreelinetable{标题}{表头 & 内容 \\}{表体行 & 内容 \\ ...}
% 示例:
%   \iqbthreelinetable{力场表现（孔寿命/ns）}{
%     力场 & DMPC & DPPC & POPC & DOPC \\
%   }{
%     C36     & 122 & 94 & 34 & 15 \\
%     Slipids & 110 & 32 & 27 & 18 \\
%   }
\newcommand{\iqbthreelinetable}[3]{%
  \vspace{-0.3cm}
  \begin{center}
  {\scriptsize
  \textbf{#1}
  \vspace{-0.05cm}

  \begin{tabular}[t]{lcccc}
    \toprule
    #2
    \midrule
    #3
    \bottomrule
  \end{tabular}
  }
  \end{center}
  \vspace{-0.3cm}
}

% 两列对比表 (简化版, 用于条件对比)
% Usage: \iqbtwocoltable{列1标题}{列2标题}{行1 & 值1 \\ 行2 & 值2 \\}
% 示例:
%   \iqbtwocoltable{脂质类型}{$\Delta\gamma$ 变化}{
%     POPG/POPS & ↑30-50\% \\
%     POPC/POPE & ≈0 \\
%   }
\newcommand{\iqbtwocoltable}[3]{%
  {\footnotesize
  \centering
  \begin{tabular}{lc}
    \toprule
    \textbf{#1} & \textbf{#2} \\
    \midrule
    #3
    \bottomrule
  \end{tabular}
  }%
}

% 多列表格 (通用版本，可自定义列数和列格式)
% Usage: \iqbmulticoltable{表头}{行1 \\ 行2 \\}
% 注: 需要在调用前定义列格式
% 示例:
%   \iqbmulticoltable{条件 & 结果 & 准确性 \\}{
%     Full-Path & 0.82 & 高 \\
%     Rapid     & 0.81 & 中 \\
%   }
\newcommand{\iqbmulticoltable}[2]{%
  {\footnotesize
  \centering
  \begin{tabular}{lll}
    \toprule
    #1
    \midrule
    #2
    \bottomrule
  \end{tabular}
  }%
}

% ============================================================
% Special Image Layout Commands (特殊图片布局)
% ============================================================

% 1:2 图文布局 (图片占1/3左侧，文字占2/3右侧)
% 用于特高竖版图，图注写在文字栏
% Usage: \iqbframeonethirdfig{标题}{左侧图片}{右侧文字}
%   或: \iqbframeonethirdfig[0.65\textheight]{标题}{左侧图片}{右侧文字}
\newcommand{\iqbframeonethirdfig}[4][0.65\textheight]{%
  \begin{frame}{#2}
    \iqblayoutonethird{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#3}%
    }{%
      \footnotesize
      #4%
    }%
  \end{frame}
}

% 2:1 图文布局 (文字占1/3左侧，图片占2/3右侧)
% 用于宽图，图注写在图片下方
% Usage: \iqbframetwothirdsfig{标题}{左侧文字}{右侧图片}
%   或: \iqbframetwothirdsfig[0.55\textheight]{标题}{左侧文字}{右侧图片}
\newcommand{\iqbframetwothirdsfig}[4][0.55\textheight]{%
  \begin{frame}{#2}
    \iqblayouttwothirds{%
      \footnotesize
      #3%
    }{%
      \centering
      \includegraphics[height=#1,keepaspectratio]{#4}%
    }%
  \end{frame}
}

% 特高竖版图 (图占1列，下方带图注)
% 用于像fig5c这样需要 1:1 或竖版显示且图注在下方的情况
% Usage: \iqbframefigcaption{标题}{图片路径}{图注文字}
%   或: \iqbframefigcaption[0.6\textheight]{标题}{图片路径}{图注文字}
\newcommand{\iqbframefigcaption}[4][0.6\textheight]{%
  \begin{frame}{#2}
    \centering
    \includegraphics[height=#1,keepaspectratio]{#3}

    \medskip

    \iqbcaptiontext{#4}%
  \end{frame}
}

% ============================================================
% P0 Priority Commands (Phase 1.5 高级增强)
% ============================================================

% ============================================================
% 封面页一行式模板 (Cover Frame Template)
% ============================================================

% 快速生成封面页（自动从元数据读取）
% Usage: \iqbcoverframe
% 自动使用已定义的元数据：\papertitlechn, \papertitlechnsub, \author, \institute, \date
\newcommand{\iqbcoverframe}{%
  \begin{frame}[plain,noframenumbering]
    \vfill
    \centering

    {\LARGE\textcolor{iqbblue}{\textbf{\@papertitlechn}}}\\[0.3cm]%
    {\LARGE\textcolor{iqbblue}{\textbf{\@papertitlechnsub}}}\\

    \medskip

    {\large \@paperengtitle}

    \bigskip

    {\normalsize \insertauthor}\\[0.2cm]%
    {\normalsize \insertinstitute}\\[0.2cm]%
    {\normalsize \insertdate}

    \vfill
  \end{frame}
}

% ============================================================
% 高亮发现块 (Highlight Findings)
% ============================================================

% 用于突出核心发现、临界结论等
% Usage: \iqbhighlight{标题}{核心内容}{强调语}
% 示例:
%   \iqbhighlight{临界发现}{
%     脂质尾部密度 $\leftrightarrow$ 孔寿命 $\tau$ (R²=0.82)
%   }{相关性极强！}
\newcommand{\iqbhighlight}[3]{%
  \textbf{#1}：\\*
  {\color{iqbblue}\textbf{#2}}

  \smallskip

  {\itshape #3}
}

% ============================================================
% 分步骤列表 (Step-by-step List)
% ============================================================

% 内部计数器
\newcounter{iqbstep}

% 重置计数器的辅助命令
\newcommand{\resetiqbstep}{\setcounter{iqbstep}{0}}

% 单个步骤
% Usage: \step{标签}{描述}
\newcommand{\step}[2]{%
  \item \textbf{#1}：#2
}

% 分步骤列表（带自动编号和间距管理）
% Usage: \iqbsteplist{标题}{步骤列表}
% 示例:
%   \iqbsteplist{四阶段闭合动力学}{
%     \step{(A) 平衡孔}{初始稳定孔，连续水柱贯穿膜厚度}
%     \step{(B) 半径缩小}{孔边缘脂质重排，整体结构保持不变}
%   }
\newcommand{\iqbsteplist}[2]{%
  \textbf{#1}：

  \smallskip

  \begin{itemize}
    #2
  \end{itemize}
}

% ============================================================
% P1 Priority Commands
% ============================================================

% ============================================================
% 带色彩强调的列表 (Color-highlighted List)
% ============================================================

% 用于展示带颜色强调的分类列表（如：✓准确 / ~部分正确 / ✗失败）
% Usage: \iqbcolorlist[颜色]{标题}{列表项}
% 颜色可选：green!60!black, orange, red 等
% 示例:
%   \iqbcolorlist[green!60!black]{力场表现}{
%     \item {\color{green!60!black}\textbf{C36/prosECCo75}}：准确（NMR调参精细）
%     \item {\color{orange}\textbf{Slipids/M2.2p}}：部分正确
%   }
\newcommand{\iqbcolorlist}[3][blue]{%
  \textbf{#2}：

  \smallskip

  \begin{itemize}
    #3
  \end{itemize}
}

% ============================================================
% Bullet 列表快捷命令 (Bullet List Shortcut)
% ============================================================

% 简化 bullet 列表的书写，自动处理间距
% Usage: \iqbbulletlist{标题}{子项}
% 其中子项使用 \item 或 \line 定义
% 示例:
%   \iqbbulletlist{线张力计算}{
%     \item Full-Path CV: 成核+扩展全过程
%     \item Rapid CV: 快速评估大孔极限
%   }
\newcommand{\iqbbulletlist}[2]{%
  \textbf{#1}\\

  \begin{itemize}
    #2
  \end{itemize}
}

% ============================================================
% 增强型公式参数块 (Enhanced Formula Parameter Block)
% ============================================================

% 参数行（在公式块中使用）
% Usage: \param{符号/公式}{说明}
\newcommand{\param}[2]{%
  $#1$ & \text{：} #2 \\
}

% 增强型公式块（包含参数表格化展示）
% Usage: \iqbformparam{公式名}{公式}{参数列表}
% 示例:
%   \iqbformparam{切换函数}{
%     s_1 = \frac{1}{1 + e^{\alpha(\text{CV}_r - \text{CV}_0)}}
%   }{
%     \param{\alpha = 20}{陡峭}
%     \param{\text{CV}_0 = 0.95}{切换点}
%   }
\newcommand{\iqbformparam}[3]{%
  \textbf{#1}：\\*[-0.1cm]
  \vspace{0.05cm}

  \centering
  #2  % 公式

  \vspace{0.05cm}

  \raggedright
  {\footnotesize
  \begin{tabular}{rl}
    #3
  \end{tabular}
  }

  \smallskip
}

\endinput
